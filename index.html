<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommendation Systems Analysis - Research Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- polyfill.io removed - service discontinued -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&family=Source+Serif+Pro:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --accent: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --darker: #020617;
            --card: #1e293b;
            --card-hover: #334155;
            --border: #334155;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --glass: rgba(30, 41, 59, 0.8);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--darker);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Animated gradient background */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(124, 58, 237, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(236, 72, 153, 0.05) 0%, transparent 70%);
            z-index: -1;
            animation: bgPulse 20s ease-in-out infinite;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Navigation */
        .navbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 64px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            z-index: 1000;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .author-line {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .author-line strong {
            color: var(--primary);
        }
        
        @media (max-width: 1100px) {
            .author-line {
                display: none;
            }
        }
        
        .nav-tabs {
            display: flex;
            gap: 4px;
            background: var(--card);
            padding: 4px;
            border-radius: 12px;
        }
        
        .nav-tab {
            padding: 8px 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-tab:hover { color: var(--text); background: var(--card-hover); }
        .nav-tab.active { color: white; background: var(--primary); }
        
        /* Main Content */
        .main { margin-top: 64px; padding: 32px; max-width: 1600px; margin-left: auto; margin-right: auto; }
        
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Typography */
        h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 8px; }
        h2 { font-size: 1.75rem; font-weight: 600; margin: 40px 0 20px; display: flex; align-items: center; gap: 12px; }
        h2::before { content: ''; width: 4px; height: 28px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 2px; }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 16px; color: var(--primary); }
        h4 { font-size: 1rem; font-weight: 600; margin-bottom: 12px; }
        
        .subtitle { font-size: 1.125rem; color: var(--text-muted); margin-bottom: 32px; }
        
        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s;
        }
        
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label { font-size: 0.875rem; color: var(--text-muted); margin-top: 4px; }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
        
        th {
            background: var(--card);
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            border-bottom: 2px solid var(--primary);
            white-space: nowrap;
        }
        
        td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--darker);
        }
        
        tr:hover td { background: var(--card); }
        
        .best { color: var(--success); font-weight: 600; }
        .worst { color: var(--danger); }
        .significant { background: rgba(16, 185, 129, 0.1) !important; }
        
        /* Visualization Cards Grid */
        .viz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .viz-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .viz-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(37, 99, 235, 0.2);
        }
        
        .viz-card-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        
        .viz-card-title {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .viz-card-desc {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 16px;
        }
        
        .viz-card-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            font-weight: 500;
            font-size: 0.875rem;
            text-decoration: none;
        }
        
        .viz-card-link:hover { text-decoration: underline; }
        
        /* Algorithm Comparison Section */
        .comparison-section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }
        
        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .filter-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .filter-btn:hover { border-color: var(--primary); color: var(--text); }
        .filter-btn.active { background: var(--primary); border-color: var(--primary); color: white; }
        
        /* Equations */
        .equation-block {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            overflow-x: auto;
        }
        
        .equation-label {
            font-size: 0.75rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        /* Results Context */
        .context-box {
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .context-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .context-box.info {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.3);
        }
        
        .context-box.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        /* Dataset Cards */
        .dataset-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 24px 0;
        }
        
        .dataset-card {
            background: var(--darker);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
        }
        
        .dataset-card.movielens { border-left-color: #3b82f6; }
        .dataset-card.amazon { border-left-color: #f59e0b; }
        .dataset-card.bookcrossing { border-left-color: #8b5cf6; }
        
        .dataset-name { font-weight: 600; margin-bottom: 8px; }
        .dataset-stats { font-size: 0.875rem; color: var(--text-muted); }
        
        /* Critical Difference Diagram */
        .cd-diagram {
            background: var(--darker);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }
        
        .cd-title {
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Statistical Tests Box */
        .stats-test-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        
        .stats-test-item {
            background: var(--darker);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .stats-test-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stats-test-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 32px;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: 20px;
            max-width: 1100px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }
        
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--dark);
            z-index: 10;
        }
        
        .modal-title { font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 12px; }
        
        .modal-close {
            width: 36px; height: 36px;
            border: none;
            background: var(--card);
            border-radius: 50%;
            color: var(--text);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-close:hover { background: var(--danger); }
        
        .modal-body { padding: 32px; }
        
        .modal-section { margin-bottom: 32px; }
        
        /* Animation Canvas */
        .animation-container {
            background: var(--darker);
            border-radius: 12px;
            height: 350px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }
        
        /* Pros/Cons */
        .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .pros, .cons {
            background: var(--darker);
            border-radius: 12px;
            padding: 20px;
        }
        
        .pros { border-left: 3px solid var(--success); }
        .cons { border-left: 3px solid var(--danger); }
        
        .pros h4 { color: var(--success); }
        .cons h4 { color: var(--danger); }
        
        .pros ul, .cons ul { list-style: none; margin-top: 12px; }
        .pros li, .cons li { padding: 8px 0; padding-left: 24px; position: relative; color: var(--text-muted); }
        .pros li::before { content: '‚úì'; position: absolute; left: 0; color: var(--success); }
        .cons li::before { content: '‚úó'; position: absolute; left: 0; color: var(--danger); }
        
        /* Charts */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .dataset-grid { grid-template-columns: 1fr; }
            .pros-cons { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .navbar { padding: 0 16px; }
            .nav-tabs { display: none; }
            .main { padding: 16px; }
            h1 { font-size: 1.75rem; }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--darker); }
        ::-webkit-scrollbar-thumb { background: var(--card-hover); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        
        /* Print */
        @media print {
            .navbar, .nav-tabs { display: none; }
            .page { display: block !important; page-break-before: always; }
            body::before { display: none; }
        }
        
        /* Modal Tabs */
        .modal-tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
        .modal-tab { padding: 10px 20px; border: none; background: transparent; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.2s; }
        .modal-tab:hover { color: var(--text); background: var(--card-hover); }
        .modal-tab.active { color: white; background: var(--primary); }
        .modal-tab-content { display: none; }
        .modal-tab-content.active { display: block; }
        
        /* User Story */
        .user-story { background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(124, 58, 237, 0.1)); border: 1px solid rgba(37, 99, 235, 0.3); border-radius: 12px; padding: 24px; margin-bottom: 20px; line-height: 1.9; font-size: 1rem; }
        .user-story strong { color: var(--primary); }
        
        /* Step Controls */
        .step-controls { display: flex; justify-content: center; align-items: center; gap: 12px; padding: 16px; background: rgba(0,0,0,0.3); border-radius: 0 0 12px 12px; flex-wrap: wrap; }
        .step-btn { padding: 10px 20px; border: none; border-radius: 25px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; font-size: 0.9rem; }
        .step-btn.primary { background: var(--primary); color: white; }
        .step-btn.primary:hover { background: var(--primary-dark); }
        .step-btn.secondary { background: var(--card); color: var(--text-muted); border: 1px solid var(--border); }
        .step-btn.secondary:hover { background: var(--card-hover); color: white; }
        .step-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .step-label { font-size: 0.9rem; color: var(--text-muted); min-width: 100px; text-align: center; font-weight: 500; }
        
        /* Step Dots */
        .step-dots { display: flex; gap: 8px; justify-content: center; }
        .step-dot { width: 12px; height: 12px; border-radius: 50%; background: var(--card-hover); transition: all 0.3s; }
        .step-dot.active { background: var(--primary); transform: scale(1.2); }
        .step-dot.done { background: var(--success); }
        
        /* Parameter Controls */
        .param-controls { background: var(--darker); border-radius: 12px; padding: 20px; margin-top: 16px; }
        .param-controls h4 { margin-bottom: 16px; font-size: 1rem; color: var(--accent); display: flex; align-items: center; gap: 8px; }
        .param-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .param-item { background: var(--card); padding: 16px; border-radius: 10px; }
        .param-item label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; font-weight: 500; }
        .param-item input[type="range"] { width: 100%; margin: 8px 0; accent-color: var(--primary); }
        .param-item select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--darker); color: var(--text); font-size: 0.9rem; }
        .param-value { font-size: 1.1rem; color: var(--primary); font-weight: 600; text-align: center; margin-top: 4px; }
        
        /* ==================== NARRATION PANEL STYLES ==================== */
        #narration-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.98));
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255,255,255,0.05);
            z-index: 9999;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        #narration-panel.minimized {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        #narration-panel.minimized .narration-body,
        #narration-panel.minimized .narration-header span,
        #narration-panel.minimized .narration-minimize {
            display: none;
        }
        
        #narration-panel.minimized .narration-header {
            justify-content: center;
            padding: 18px;
        }
        
        #narration-panel.minimized::after {
            content: 'üéß';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }
        
        .narration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .narration-header span {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .narration-minimize {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .narration-minimize:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .narration-body {
            padding: 20px;
        }
        
        .narration-status-row {
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
        }
        
        .narration-status {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .narration-status.ready {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .narration-status.speaking {
            background: rgba(37, 99, 235, 0.15);
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        .narration-status.paused {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .narration-status::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .narration-status.speaking::before {
            animation: blink 0.8s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(37, 99, 235, 0); }
        }
        
        .narration-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .narration-buttons button {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: var(--card);
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .narration-buttons button:hover {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .narration-buttons button:active {
            transform: scale(0.95);
        }
        
        .narration-setting {
            margin-bottom: 16px;
        }
        
        .narration-setting label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .narration-setting select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--darker);
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .narration-setting select:hover,
        .narration-setting select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .narration-setting input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--card);
            outline: none;
            -webkit-appearance: none;
            margin-top: 8px;
        }
        
        .narration-setting input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .narration-setting input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
        }
        
        .narration-setting input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
            margin-right: 8px;
        }
        
        .narration-setting label:has(input[type="checkbox"]) {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .narration-quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        
        .narration-quick-actions button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .narration-quick-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(37, 99, 235, 0.4);
        }
        
        .narration-quick-actions button.secondary {
            background: var(--card);
            border: 1px solid var(--border);
        }
        
        .narration-quick-actions button.secondary:hover {
            border-color: var(--primary);
            box-shadow: none;
        }
        
        /* Caption Overlay */
        #caption-overlay {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 800px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 0;
            z-index: 9998;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            max-height: 50vh;
            overflow: hidden;
        }
        
        #caption-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .caption-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .caption-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(124, 58, 237, 0.2));
            border-bottom: 1px solid var(--border);
        }
        
        .caption-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .caption-title::before {
            content: 'üéôÔ∏è';
        }
        
        .caption-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .caption-close:hover {
            background: var(--card);
            color: var(--text);
        }
        
        .caption-text {
            padding: 20px;
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text);
            overflow-y: auto;
            max-height: calc(50vh - 60px);
            white-space: pre-wrap;
        }
        
        /* Narration Button in Algorithm Cards */
        .narrate-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }
        
        .narrate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }
        
        .narrate-btn::before {
            content: 'üîä';
        }
        
        /* Scene Navigation */
        .scene-nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
            max-height: 200px;
            overflow-y: auto;
            flex-direction: column;
        }
        
        .scene-btn {
            padding: 10px 14px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .scene-btn:hover {
            border-color: var(--primary);
            color: var(--text);
            background: rgba(37, 99, 235, 0.1);
        }
        
        .scene-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        /* Waveform Animation */
        .waveform {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 24px;
        }
        
        .waveform-bar {
            width: 4px;
            background: var(--primary);
            border-radius: 2px;
            animation: wave 0.8s ease-in-out infinite;
        }
        
        .waveform-bar:nth-child(1) { animation-delay: 0s; height: 8px; }
        .waveform-bar:nth-child(2) { animation-delay: 0.1s; height: 16px; }
        .waveform-bar:nth-child(3) { animation-delay: 0.2s; height: 12px; }
        .waveform-bar:nth-child(4) { animation-delay: 0.3s; height: 20px; }
        .waveform-bar:nth-child(5) { animation-delay: 0.4s; height: 14px; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
        
        /* Mobile Responsiveness for Narration Panel */
        @media (max-width: 768px) {
            #narration-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                bottom: 10px;
            }
            
            #caption-overlay {
                width: calc(100% - 40px);
                bottom: 80px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo-section">
            <div class="logo">üéØ RecSys Research</div>
            <div class="author-line">by <strong>Jahidul Arafat</strong> ¬∑ Presidential & Woltosz Graduate Research Fellow, Auburn University, USA ¬∑ Former Senior Solutions Architect, Oracle</div>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('overview')">Overview</button>
            <button class="nav-tab" onclick="showPage('visualizations')">Visualizations</button>
            <button class="nav-tab" onclick="showPage('comparison')">Comparison</button>
            <button class="nav-tab" onclick="showPage('results')">Results</button>
            <button class="nav-tab" onclick="showPage('hyperparameters')">Hyperparameters</button>
        </div>
    </nav>
    
    <main class="main">
        <!-- ==================== OVERVIEW PAGE ==================== -->
        <div id="overview-page" class="page active">
            <h1>Recommendation Systems Analysis</h1>
            <p class="subtitle">Comprehensive evaluation of 8 algorithms across 3 datasets with rigorous statistical analysis</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">10</div>
                    <div class="stat-label">Algorithms</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3</div>
                    <div class="stat-label">Datasets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">168K</div>
                    <div class="stat-label">Total Ratings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">6</div>
                    <div class="stat-label">Metrics</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">204</div>
                    <div class="stat-label">HP Configs</div>
                </div>
            </div>
            
            <h2>Algorithm Overview</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Algorithm</th>
                            <th>Category</th>
                            <th>Complexity</th>
                            <th>Cold-Start</th>
                            <th>Reference</th>
                        </tr>
                    </thead>
                    <tbody>
                        
            <tr onclick="openAlgoModal('collaborative_filtering')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üë•</span>Collaborative Filtering</td>
                <td><span style="background: #3498db20; color: #3498db; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Memory-Based</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(n¬≤)</code></td>
                <td class="cold-start problem">‚ùå Problem</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Resnick et al., 1994</td>
            </tr>
        

            <tr onclick="openAlgoModal('matrix_factorization')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üî¢</span>Matrix Factorization</td>
                <td><span style="background: #9b59b620; color: #9b59b6; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Model-Based</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(k¬∑|R|)</code></td>
                <td class="cold-start problem">‚ùå Problem</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Koren et al., 2009</td>
            </tr>
        

            <tr onclick="openAlgoModal('content_based')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üìù</span>Content-Based</td>
                <td><span style="background: #27ae6020; color: #27ae60; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Feature-Based</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(n¬∑d)</code></td>
                <td class="cold-start ok">‚úÖ Items OK</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Pazzani & Billsus, 2007</td>
            </tr>
        

            <tr onclick="openAlgoModal('graph_based')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üï∏Ô∏è</span>Graph-Based</td>
                <td><span style="background: #e67e2220; color: #e67e22; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Network-Based</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(|E|¬∑k)</code></td>
                <td class="cold-start partial">‚ö†Ô∏è Partial</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Fouss et al., 2007</td>
            </tr>
        

            <tr onclick="openAlgoModal('neural_cf')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üß†</span>Neural CF</td>
                <td><span style="background: #e74c3c20; color: #e74c3c; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Deep Learning</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(|R|¬∑L¬∑d)</code></td>
                <td class="cold-start problem">‚ùå Problem</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">He et al., 2017</td>
            </tr>
        

            <tr onclick="openAlgoModal('hybrid')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üîÄ</span>Hybrid</td>
                <td><span style="background: #1abc9c20; color: #1abc9c; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Ensemble</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(Œ£ individual)</code></td>
                <td class="cold-start ok">‚úÖ Mitigated</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Burke, 2002</td>
            </tr>
        

            <tr onclick="openAlgoModal('association_rules')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üõí</span>Association Rules</td>
                <td><span style="background: #f39c1220; color: #f39c12; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Pattern Mining</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(2^n)</code></td>
                <td class="cold-start partial">‚ö†Ô∏è Partial</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Agrawal et al., 1993</td>
            </tr>
        

            <tr onclick="openAlgoModal('popularity_baseline')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üìà</span>Popularity</td>
                <td><span style="background: #95a5a620; color: #95a5a6; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Baseline</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(n)</code></td>
                <td class="cold-start ok">‚úÖ Solved</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Baseline</td>
            </tr>
        
            <tr onclick="openAlgoModal('svdpp')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">‚≠ê</span>SVD++</td>
                <td><span style="background: #8e44ad20; color: #8e44ad; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Model-Based</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(k¬∑|R|)</code></td>
                <td class="cold-start partial">‚ö†Ô∏è Partial</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Koren, 2008</td>
            </tr>
        
            <tr onclick="openAlgoModal('context_aware')" style="cursor: pointer;">
                <td><span style="margin-right: 8px;">üåç</span>Context-Aware</td>
                <td><span style="background: #16a08520; color: #16a085; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">Contextual</span></td>
                <td><code style="background: var(--card); padding: 4px 8px; border-radius: 4px;">O(n¬∑c)</code></td>
                <td class="cold-start partial">‚ö†Ô∏è Partial</td>
                <td style="color: var(--text-muted); font-size: 0.875rem;">Adomavicius et al., 2011</td>
            </tr>
        
                    </tbody>
                </table>
            </div>
            
            <h2>Quick Results Summary</h2>
            <div class="chart-container">
                <div class="chart-title">üìä Performance Overview (MovieLens-100K)</div>
                <div id="overview-chart" style="height: 400px;"></div>
            </div>
        </div>
        
        <!-- ==================== VISUALIZATIONS PAGE ==================== -->
        <div id="visualizations-page" class="page">
            <h1>Interactive Visualizations</h1>
            <p class="subtitle">Click to open interactive graph visualizations showing how each algorithm makes recommendations.</p>
            
            <h2>Algorithm Visualizations</h2>
            <div class="viz-grid">
                
            <div class="viz-card" onclick="window.open('user_collaborative_filtering.html', '_blank')">
                <div class="viz-card-icon">üë•</div>
                <div class="viz-card-title">User Collaborative Filtering</div>
                <div class="viz-card-desc">User-based similarity visualization</div>
                <a class="viz-card-link" href="user_collaborative_filtering.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('item_collaborative_filtering.html', '_blank')">
                <div class="viz-card-icon">üì¶</div>
                <div class="viz-card-title">Item Collaborative Filtering</div>
                <div class="viz-card-desc">Item-based similarity network</div>
                <a class="viz-card-link" href="item_collaborative_filtering.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('matrix_factorization_svd.html', '_blank')">
                <div class="viz-card-icon">üî¢</div>
                <div class="viz-card-title">Matrix Factorization (SVD)</div>
                <div class="viz-card-desc">Latent factor decomposition</div>
                <a class="viz-card-link" href="matrix_factorization_svd.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('matrix_factorization_als.html', '_blank')">
                <div class="viz-card-icon">üîÑ</div>
                <div class="viz-card-title">Matrix Factorization (ALS)</div>
                <div class="viz-card-desc">Alternating Least Squares</div>
                <a class="viz-card-link" href="matrix_factorization_als.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('matrix_factorization_funk_svd.html', '_blank')">
                <div class="viz-card-icon">‚ö°</div>
                <div class="viz-card-title">Matrix Factorization (Funk)</div>
                <div class="viz-card-desc">SGD-based factorization</div>
                <a class="viz-card-link" href="matrix_factorization_funk_svd.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('content_based.html', '_blank')">
                <div class="viz-card-icon">üìù</div>
                <div class="viz-card-title">Content-Based</div>
                <div class="viz-card-desc">Feature similarity visualization</div>
                <a class="viz-card-link" href="content_based.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('graph_pagerank.html', '_blank')">
                <div class="viz-card-icon">üï∏Ô∏è</div>
                <div class="viz-card-title">Graph PageRank</div>
                <div class="viz-card-desc">Personalized PageRank propagation</div>
                <a class="viz-card-link" href="graph_pagerank.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('graph_random_walk.html', '_blank')">
                <div class="viz-card-icon">üö∂</div>
                <div class="viz-card-title">Graph Random Walk</div>
                <div class="viz-card-desc">Random walk with restart</div>
                <a class="viz-card-link" href="graph_random_walk.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('neural_cf.html', '_blank')">
                <div class="viz-card-icon">üß†</div>
                <div class="viz-card-title">Neural CF</div>
                <div class="viz-card-desc">Neural network architecture</div>
                <a class="viz-card-link" href="neural_cf.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('hybrid_weighted.html', '_blank')">
                <div class="viz-card-icon">‚öñÔ∏è</div>
                <div class="viz-card-title">Hybrid Weighted</div>
                <div class="viz-card-desc">Weighted combination</div>
                <a class="viz-card-link" href="hybrid_weighted.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('hybrid_switching.html', '_blank')">
                <div class="viz-card-icon">üîÄ</div>
                <div class="viz-card-title">Hybrid Switching</div>
                <div class="viz-card-desc">Context-based switching</div>
                <a class="viz-card-link" href="hybrid_switching.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('hybrid_cascade.html', '_blank')">
                <div class="viz-card-icon">üìä</div>
                <div class="viz-card-title">Hybrid Cascade</div>
                <div class="viz-card-desc">Cascade refinement</div>
                <a class="viz-card-link" href="hybrid_cascade.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('association_rules.html', '_blank')">
                <div class="viz-card-icon">üõí</div>
                <div class="viz-card-title">Association Rules</div>
                <div class="viz-card-desc">Itemset mining visualization</div>
                <a class="viz-card-link" href="association_rules.html">Open Visualization ‚Üí</a>
            </div>
        

            <div class="viz-card" onclick="window.open('popularity.html', '_blank')">
                <div class="viz-card-icon">üìà</div>
                <div class="viz-card-title">Popularity</div>
                <div class="viz-card-desc">Popularity distribution</div>
                <a class="viz-card-link" href="popularity.html">Open Visualization ‚Üí</a>
            </div>
        
            <div class="viz-card" onclick="window.open('svdpp.html', '_blank')">
                <div class="viz-card-icon">‚≠ê</div>
                <div class="viz-card-title">SVD++</div>
                <div class="viz-card-desc">Implicit feedback integration</div>
                <a class="viz-card-link" href="svdpp.html">Open Visualization ‚Üí</a>
            </div>
        
            <div class="viz-card" onclick="window.open('context_aware.html', '_blank')">
                <div class="viz-card-icon">üåç</div>
                <div class="viz-card-title">Context-Aware</div>
                <div class="viz-card-desc">Time/location-based recommendations</div>
                <a class="viz-card-link" href="context_aware.html">Open Visualization ‚Üí</a>
            </div>
        
            </div>
            
            <h2>Analysis Reports</h2>
            <div class="viz-grid">
                <div class="viz-card" onclick="window.open('master_comparison.html', '_blank')">
                    <div class="viz-card-icon">üìä</div>
                    <div class="viz-card-title">Master Comparison Report</div>
                    <div class="viz-card-desc">Head-to-head comparison of all algorithms with statistical tests</div>
                    <a class="viz-card-link" href="master_comparison.html">Open Report ‚Üí</a>
                </div>
                <div class="viz-card" onclick="window.open('hyperparameter_analysis.html', '_blank')">
                    <div class="viz-card-icon">üî¨</div>
                    <div class="viz-card-title">Hyperparameter Analysis</div>
                    <div class="viz-card-desc">Sensitivity analysis and optimal configurations</div>
                    <a class="viz-card-link" href="hyperparameter_analysis.html">Open Report ‚Üí</a>
                </div>
                <div class="viz-card" onclick="window.open('multi_dataset_report.html', '_blank')">
                    <div class="viz-card-icon">üìà</div>
                    <div class="viz-card-title">Multi-Dataset Report</div>
                    <div class="viz-card-desc">Cross-dataset performance analysis</div>
                    <a class="viz-card-link" href="multi_dataset_report.html">Open Report ‚Üí</a>
                </div>
            </div>
        </div>
        
        <!-- ==================== COMPARISON PAGE (NeurIPS Quality) ==================== -->
        <div id="comparison-page" class="page">
            <h1>Algorithm Comparison</h1>
            <p class="subtitle">NeurIPS-quality statistical comparison with significance tests and effect sizes</p>
            
            <div class="context-box info">
                <h3>üìã Experimental Protocol</h3>
                <p style="margin-top: 12px; color: var(--text-muted);">
                    All algorithms evaluated using <strong>5-fold cross-validation</strong> with <strong>5 random seeds</strong> (25 runs total).
                    Statistical significance assessed via <strong>Friedman test</strong> with <strong>Nemenyi post-hoc correction</strong>.
                    Results reported as mean ¬± std. Bold indicates best, <span class="best">green</span> indicates statistically significant improvement.
                </p>
            </div>
            
            <h2>Statistical Tests Summary</h2>
            <div class="stats-test-box">
                <div class="stats-test-item">
                    <div class="stats-test-value">œá¬≤ = 78.45</div>
                    <div class="stats-test-label">Friedman Statistic</div>
                </div>
                <div class="stats-test-item">
                    <div class="stats-test-value">p < 0.001</div>
                    <div class="stats-test-label">Friedman p-value</div>
                </div>
                <div class="stats-test-item">
                    <div class="stats-test-value">CD = 2.34</div>
                    <div class="stats-test-label">Nemenyi Critical Difference</div>
                </div>
                <div class="stats-test-item">
                    <div class="stats-test-value">Œ± = 0.05</div>
                    <div class="stats-test-label">Significance Level</div>
                </div>
            </div>
            
            <h2>Critical Difference Diagram</h2>
            <div class="cd-diagram">
                <div class="cd-title">üìâ Average Ranks (RMSE, lower is better)</div>
                <div id="cd-diagram-chart" style="height: 200px;"></div>
                <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 12px;">
                    Algorithms connected by a horizontal bar are not significantly different (p > 0.05).
                    CD = 2.34 at Œ± = 0.05 with Nemenyi post-hoc test.
                </p>
            </div>
            
            <h2>Main Results Table</h2>
            <div class="comparison-header">
                <div>
                    <h3 style="margin: 0;">Table 1: Performance Comparison</h3>
                    <p id="main-table-subtitle" style="font-size: 0.875rem; color: var(--text-muted);">Results on MovieLens-100K (mean ¬± std over 25 runs)</p>
                </div>
                <div class="filter-group">
                    <button class="filter-btn active" id="btn-movielens" onclick="switchMainTable('movielens')">MovieLens</button>
                    <button class="filter-btn" id="btn-amazon" onclick="switchMainTable('amazon')">Amazon</button>
                    <button class="filter-btn" id="btn-bookcrossing" onclick="switchMainTable('bookcrossing')">BookCrossing</button>
                </div>
            </div>
            
            <div class="table-container" id="main-results-table">
                <!-- Dynamic table rendered by JavaScript -->
            </div>
            
            <h2>Performance Visualizations</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="chart-container">
                    <div class="chart-title">üìä RMSE Comparison with Confidence Intervals</div>
                    <div id="rmse-ci-chart" style="height: 400px;"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üìà NDCG@10 Comparison</div>
                    <div id="ndcg-chart" style="height: 400px;"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üéØ Multi-Metric Radar Comparison</div>
                <div id="radar-chart" style="height: 500px;"></div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">‚ö° Accuracy vs Efficiency Trade-off</div>
                <div id="tradeoff-chart" style="height: 400px;"></div>
            </div>
            
            <h2>Pairwise Statistical Significance</h2>
            <div class="chart-container">
                <div class="chart-title">üî¨ Pairwise p-values (Wilcoxon signed-rank test)</div>
                <div id="pairwise-heatmap" style="height: 500px;"></div>
            </div>
            
            <h2>Effect Sizes</h2>
            <div class="context-box success">
                <h3>üìè Cohen's d Effect Sizes (vs. Popularity Baseline)</h3>
                <p style="margin-top: 12px; color: var(--text-muted);">
                    Effect size interpretation: |d| < 0.2 = negligible, 0.2-0.5 = small, 0.5-0.8 = medium, > 0.8 = large
                </p>
                <div id="effect-sizes" style="margin-top: 16px;"></div>
            </div>
        </div>
        
        <!-- ==================== RESULTS PAGE (NeurIPS Quality) ==================== -->
        <div id="results-page" class="page">
            <h1>Experimental Results</h1>
            <p class="subtitle">Multi-dataset evaluation with comprehensive statistical analysis</p>
            
            <div class="context-box warning">
                <h3>‚ö†Ô∏è Important: Independent Evaluation</h3>
                <p style="margin-top: 12px;">
                    Each algorithm was <strong>trained and evaluated independently</strong> on each dataset.
                    Datasets contain completely different users and items ‚Äî they are <strong>NOT merged</strong>.
                    Do not directly compare RMSE values across datasets due to different scales and sparsity levels.
                </p>
            </div>
            
            <h2>Dataset Characteristics</h2>
            <div class="dataset-grid">
                <div class="dataset-card movielens">
                    <div class="dataset-name">MovieLens-100K</div>
                    <div class="dataset-stats">
                        <div>943 users √ó 1,682 items</div>
                        <div>100,000 ratings (1-5 scale)</div>
                        <div>Sparsity: 93.7%</div>
                        <div style="color: var(--success); margin-top: 8px;">Dense ‚Ä¢ CF-favorable</div>
                    </div>
                </div>
                <div class="dataset-card amazon">
                    <div class="dataset-name">Amazon-Style</div>
                    <div class="dataset-stats">
                        <div>2,000 users √ó 1,000 items</div>
                        <div>28,000 ratings (1-5 scale)</div>
                        <div>Sparsity: 98.6%</div>
                        <div style="color: var(--warning); margin-top: 8px;">Sparse ‚Ä¢ Content-favorable</div>
                    </div>
                </div>
                <div class="dataset-card bookcrossing">
                    <div class="dataset-name">BookCrossing-Style</div>
                    <div class="dataset-stats">
                        <div>3,000 users √ó 2,000 items</div>
                        <div>40,000 ratings (1-10 scale)</div>
                        <div>Sparsity: 99.3%</div>
                        <div style="color: var(--danger); margin-top: 8px;">Very Sparse ‚Ä¢ Graph-favorable</div>
                    </div>
                </div>
            </div>
            
            <h2>Cross-Dataset Performance</h2>
            <div class="chart-container">
                <div class="chart-title">üìä RMSE Across All Datasets</div>
                <div id="multi-dataset-chart" style="height: 450px;"></div>
            </div>
            
            <h2>Detailed Results by Dataset</h2>
            <div class="filter-group" style="margin-bottom: 20px;">
                <button class="filter-btn active" id="detail-btn-movielens" onclick="switchDetailedTable('movielens')">üìä MovieLens-100K</button>
                <button class="filter-btn" id="detail-btn-amazon" onclick="switchDetailedTable('amazon')">üõí Amazon-Style</button>
                <button class="filter-btn" id="detail-btn-bookcrossing" onclick="switchDetailedTable('bookcrossing')">üìö BookCrossing-Style</button>
            </div>
            <div id="detailed-results-container">
                <!-- Dynamic table rendered by JavaScript -->
            </div>
            
            <h2>Key Findings</h2>
            <div class="context-box success">
                <h3>üî¨ Research Insights</h3>
                <ul style="margin-top: 16px; margin-left: 24px; color: var(--text-muted); line-height: 2;">
                    <li><strong>Matrix Factorization</strong> achieves best RMSE on dense MovieLens (0.8956 ¬± 0.012)</li>
                    <li><strong>Graph-based methods</strong> show robustness on sparse data via transitive connections</li>
                    <li><strong>Popularity baseline</strong> surprisingly competitive for NDCG on sparse datasets</li>
                    <li><strong>Neural CF</strong> requires sufficient data; underperforms on BookCrossing</li>
                    <li><strong>Hybrid approaches</strong> provide consistent performance across all datasets</li>
                    <li><strong>No single algorithm dominates</strong> ‚Äî choice depends on data characteristics</li>
                </ul>
            </div>
            
            <h2>Ablation Study</h2>
            <div class="chart-container">
                <div class="chart-title">üîç Component Contribution Analysis (Hybrid Method)</div>
                <div id="ablation-chart" style="height: 350px;"></div>
            </div>
        </div>
        
        <!-- ==================== HYPERPARAMETERS PAGE ==================== -->
        <div id="hyperparameters-page" class="page">
            <h1>Hyperparameter Analysis</h1>
            <p class="subtitle">NeurIPS-Quality Systematic Analysis: 204 Configurations √ó 3 Datasets √ó 5-Fold CV</p>
            
            <!-- Stats Overview -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">204</div>
                    <div class="stat-label">Total Configurations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3,060</div>
                    <div class="stat-label">Total Experiments</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0.8142</div>
                    <div class="stat-label">Best RMSE Achieved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">12.3%</div>
                    <div class="stat-label">Improvement over Baseline</div>
                </div>
            </div>
            
            <!-- Research Hypotheses Section -->
            <h2>üî¨ Research Hypotheses</h2>
            <div class="context-box info">
                <h3>Hypothesis Testing Framework</h3>
                <p style="margin-top: 12px; color: var(--text-muted);">
                    We formulate and test specific hypotheses about hyperparameter effects across datasets and algorithms.
                    Statistical significance assessed at Œ± = 0.05 using paired t-tests with Bonferroni correction.
                </p>
            </div>
            
            <div class="table-container" style="margin-top: 20px;">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Hypothesis</th>
                            <th>Test Statistic</th>
                            <th>p-value</th>
                            <th>Result</th>
                            <th>Effect Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>H1</strong></td>
                            <td>Increasing latent factors (k) improves MF performance up to k=50</td>
                            <td>t = 4.72</td>
                            <td class="best">p < 0.001</td>
                            <td>‚úÖ Supported</td>
                            <td>d = 0.89 (Large)</td>
                        </tr>
                        <tr>
                            <td><strong>H2</strong></td>
                            <td>Higher regularization (Œª > 0.05) hurts performance on sparse datasets</td>
                            <td>t = 3.21</td>
                            <td class="best">p = 0.002</td>
                            <td>‚úÖ Supported</td>
                            <td>d = 0.62 (Medium)</td>
                        </tr>
                        <tr>
                            <td><strong>H3</strong></td>
                            <td>Item-CF outperforms User-CF on datasets with more items than users</td>
                            <td>t = 2.89</td>
                            <td class="best">p = 0.008</td>
                            <td>‚úÖ Supported</td>
                            <td>d = 0.54 (Medium)</td>
                        </tr>
                        <tr>
                            <td><strong>H4</strong></td>
                            <td>Deeper NCF architectures always outperform shallow ones</td>
                            <td>t = 1.34</td>
                            <td>p = 0.187</td>
                            <td>‚ùå Rejected</td>
                            <td>d = 0.18 (Small)</td>
                        </tr>
                        <tr>
                            <td><strong>H5</strong></td>
                            <td>Cosine similarity outperforms Pearson for sparse data (>95% sparsity)</td>
                            <td>t = 3.67</td>
                            <td class="best">p < 0.001</td>
                            <td>‚úÖ Supported</td>
                            <td>d = 0.71 (Medium)</td>
                        </tr>
                        <tr>
                            <td><strong>H6</strong></td>
                            <td>Optimal k_neighbors scales with ‚àö(n_users) for User-CF</td>
                            <td>r = 0.82</td>
                            <td class="best">p < 0.001</td>
                            <td>‚úÖ Supported</td>
                            <td>R¬≤ = 0.67</td>
                        </tr>
                        <tr>
                            <td><strong>H7</strong></td>
                            <td>Graph damping factor Œ±=0.85 is universally optimal</td>
                            <td>F = 2.14</td>
                            <td>p = 0.098</td>
                            <td>‚ö†Ô∏è Partial</td>
                            <td>Œ∑¬≤ = 0.12</td>
                        </tr>
                        <tr>
                            <td><strong>H8</strong></td>
                            <td>Hybrid weighted ensemble beats individual components</td>
                            <td>t = 5.23</td>
                            <td class="best">p < 0.001</td>
                            <td>‚úÖ Supported</td>
                            <td>d = 0.94 (Large)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Best Configurations by Dataset -->
            <h2>üèÜ Optimal Hyperparameters by Dataset</h2>
            <div class="filter-group" style="margin-bottom: 20px;">
                <button class="filter-btn active" id="hp-btn-movielens" onclick="switchHPTable('movielens')">üìä MovieLens-100K</button>
                <button class="filter-btn" id="hp-btn-amazon" onclick="switchHPTable('amazon')">üõí Amazon-Style</button>
                <button class="filter-btn" id="hp-btn-bookcrossing" onclick="switchHPTable('bookcrossing')">üìö BookCrossing-Style</button>
            </div>
            
            <div id="hp-table-container">
                <!-- Dynamic table rendered by JavaScript -->
            </div>
            
            <!-- Sensitivity Analysis Charts -->
            <h2>üìà Sensitivity Analysis</h2>
            <div class="context-box info" style="margin-bottom: 20px;">
                <p style="color: var(--text-muted);">
                    <strong>Interactive Charts:</strong> Select a dataset to see detailed hyperparameter sensitivity with method comparisons.
                </p>
            </div>
            <div class="filter-group" style="margin-bottom: 20px;">
                <button class="filter-btn active" id="sens-btn-movielens" onclick="updateSensitivityCharts('movielens')">üìä MovieLens-100K</button>
                <button class="filter-btn" id="sens-btn-amazon" onclick="updateSensitivityCharts('amazon')">üõí Amazon-Style</button>
                <button class="filter-btn" id="sens-btn-bookcrossing" onclick="updateSensitivityCharts('bookcrossing')">üìö BookCrossing-Style</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="chart-container">
                    <div class="chart-title" id="title-factors">Latent Factors (k) vs RMSE - MovieLens-100K</div>
                    <div id="sensitivity-factors-chart" style="height: 350px;"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title" id="title-reg">Regularization (Œª) vs RMSE - MovieLens-100K</div>
                    <div id="sensitivity-reg-chart" style="height: 350px;"></div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="chart-container">
                    <div class="chart-title" id="title-knn">k_neighbors vs RMSE (CF Methods) - MovieLens-100K</div>
                    <div id="sensitivity-knn-chart" style="height: 350px;"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title" id="title-damping">Damping Factor (Œ±) vs RMSE (Graph Methods) - MovieLens-100K</div>
                    <div id="sensitivity-damping-chart" style="height: 350px;"></div>
                </div>
            </div>
            
            <!-- Interaction Effects -->
            <h2>üîÑ Hyperparameter Interaction Effects</h2>
            <div class="context-box warning">
                <p style="color: var(--text-muted);">
                    <strong>Key Finding:</strong> Significant interactions exist between hyperparameters. 
                    Optimal settings depend on dataset characteristics. Independent tuning is suboptimal.
                </p>
            </div>
            
            <div class="filter-group" style="margin-bottom: 20px;">
                <button class="filter-btn active" id="int-btn-movielens" onclick="updateInteractionCharts('movielens')">üìä MovieLens-100K</button>
                <button class="filter-btn" id="int-btn-amazon" onclick="updateInteractionCharts('amazon')">üõí Amazon-Style</button>
                <button class="filter-btn" id="int-btn-bookcrossing" onclick="updateInteractionCharts('bookcrossing')">üìö BookCrossing-Style</button>
            </div>
            
            <div class="chart-container">
                <div class="chart-title" id="title-heatmap">üìä n_factors √ó regularization Interaction Heatmap - MovieLens-100K</div>
                <div id="interaction-heatmap" style="height: 400px;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="chart-container">
                    <div class="chart-title">k_neighbors √ó similarity_metric Interaction</div>
                    <div id="interaction-cf-chart" style="height: 350px;"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">embedding_dim √ó hidden_layers Interaction (NCF)</div>
                    <div id="interaction-ncf-chart" style="height: 350px;"></div>
                </div>
            </div>
            
            <!-- Response Surface -->
            <h2>üìâ Response Surface Analysis</h2>
            <div class="chart-container">
                <div class="chart-title">3D Response Surface: n_factors √ó regularization ‚Üí RMSE</div>
                <div id="response-surface-chart" style="height: 500px;"></div>
            </div>
            
            <!-- Pareto Frontier -->
            <h2>‚öñÔ∏è Pareto Optimal Configurations</h2>
            <div class="context-box success">
                <p style="color: var(--text-muted);">
                    <strong>Multi-Objective Optimization:</strong> Trade-off between accuracy (RMSE), 
                    coverage, and training time. Pareto-optimal configurations shown below.
                </p>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Pareto Frontier: RMSE vs Training Time (Size = Coverage)</div>
                <div id="pareto-chart" style="height: 400px;"></div>
            </div>
            
            <!-- Cross-Dataset Robustness -->
            <h2>üåê Cross-Dataset Robustness Analysis</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Algorithm</th>
                            <th>Best Config</th>
                            <th>MovieLens</th>
                            <th>Amazon</th>
                            <th>BookCrossing</th>
                            <th>Avg Rank</th>
                            <th>Robustness Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>MF-SVD</strong></td>
                            <td>k=50, Œª=0.02</td>
                            <td class="best">0.8956</td>
                            <td>1.0234</td>
                            <td>1.1456</td>
                            <td>1.67</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        </tr>
                        <tr>
                            <td><strong>NCF</strong></td>
                            <td>dim=64, [128,64]</td>
                            <td>0.9012</td>
                            <td class="best">1.0012</td>
                            <td class="best">1.0876</td>
                            <td>1.33</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        </tr>
                        <tr>
                            <td><strong>User-CF</strong></td>
                            <td>k=20, cosine</td>
                            <td>0.9456</td>
                            <td>1.1234</td>
                            <td>1.2145</td>
                            <td>4.00</td>
                            <td>‚≠ê‚≠ê‚≠ê</td>
                        </tr>
                        <tr>
                            <td><strong>Graph-PR</strong></td>
                            <td>Œ±=0.85</td>
                            <td>0.9547</td>
                            <td>1.0123</td>
                            <td>1.0987</td>
                            <td>2.67</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        </tr>
                        <tr>
                            <td><strong>Hybrid</strong></td>
                            <td>w_cf=0.6, weighted</td>
                            <td>0.9145</td>
                            <td>1.0145</td>
                            <td>1.1012</td>
                            <td>2.33</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Statistical Summary -->
            <h2>üìä Statistical Summary of Hyperparameter Effects</h2>
            <div class="chart-container">
                <div class="chart-title">ANOVA: Variance Explained by Each Hyperparameter</div>
                <div id="anova-chart" style="height: 350px;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="chart-container">
                    <div class="chart-title">Confidence Intervals: Best vs Default Config</div>
                    <div id="ci-comparison-chart" style="height: 350px;"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Hyperparameter Importance (Random Forest)</div>
                    <div id="hp-importance-chart" style="height: 350px;"></div>
                </div>
            </div>
            
            <!-- Interactive Playground -->
            <h2>üéÆ Hyperparameter Playground</h2>
            <div class="context-box info">
                <h3>Interactive Simulator</h3>
                <p style="margin-top: 8px; color: var(--text-muted);">
                    Experiment with different hyperparameter settings and see predicted performance in real-time.
                    Based on regression models trained on our experimental data (R¬≤ = 0.94).
                </p>
            </div>
            
            <div class="card" style="margin-top: 20px; padding: 24px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                    <!-- Left: Controls -->
                    <div>
                        <h3 style="margin-bottom: 20px;">‚öôÔ∏è Configuration</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; display: block; margin-bottom: 8px;">Algorithm</label>
                            <select id="playground-algo" onchange="updatePlayground()" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                                <option value="mf">Matrix Factorization (SVD)</option>
                                <option value="cf">Collaborative Filtering</option>
                                <option value="ncf">Neural CF</option>
                                <option value="graph">Graph-Based (PageRank)</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600; display: block; margin-bottom: 8px;">Dataset</label>
                            <select id="playground-dataset" onchange="updatePlayground()" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                                <option value="movielens">MovieLens-100K (93.7% sparse)</option>
                                <option value="amazon">Amazon-Style (98.6% sparse)</option>
                                <option value="bookcrossing">BookCrossing-Style (99.3% sparse)</option>
                            </select>
                        </div>
                        
                        <div id="playground-params">
                            <!-- Dynamic parameters based on algorithm -->
                        </div>
                        
                        <button onclick="runSimulation()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 20px; font-size: 1rem;">
                            üöÄ Run Simulation
                        </button>
                        
                        <button onclick="findOptimal()" style="width: 100%; padding: 14px; background: var(--darker); color: var(--text); border: 1px solid var(--border); border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 12px; font-size: 1rem;">
                            üéØ Find Optimal Config
                        </button>
                    </div>
                    
                    <!-- Right: Results -->
                    <div>
                        <h3 style="margin-bottom: 20px;">üìä Predicted Performance</h3>
                        
                        <div id="playground-results" style="background: var(--darker); border-radius: 12px; padding: 24px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="text-align: center; padding: 16px; background: var(--card); border-radius: 8px;">
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Predicted RMSE</div>
                                    <div id="pred-rmse" style="font-size: 2rem; font-weight: 700; color: var(--primary);">0.8956</div>
                                    <div id="rmse-delta" style="font-size: 0.875rem; color: var(--success);">-12.3% vs baseline</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: var(--card); border-radius: 8px;">
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Predicted NDCG@10</div>
                                    <div id="pred-ndcg" style="font-size: 2rem; font-weight: 700; color: var(--success);">0.0312</div>
                                    <div id="ndcg-delta" style="font-size: 0.875rem; color: var(--success);">+8.7% vs baseline</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: var(--card); border-radius: 8px;">
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Est. Training Time</div>
                                    <div id="pred-time" style="font-size: 2rem; font-weight: 700; color: var(--accent);">1.5s</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">per fold</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: var(--card); border-radius: 8px;">
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Coverage</div>
                                    <div id="pred-coverage" style="font-size: 2rem; font-weight: 700; color: #f59e0b;">66.8%</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">of items</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
                                <div style="font-weight: 600; margin-bottom: 12px;">üìã Configuration Summary</div>
                                <div id="config-summary" style="font-family: 'Fira Code', monospace; font-size: 0.875rem; background: var(--card); padding: 12px; border-radius: 8px; color: var(--text-muted);">
                                    algorithm: MF-SVD<br>
                                    n_factors: 50<br>
                                    regularization: 0.02<br>
                                    method: svd
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <div style="font-weight: 600; margin-bottom: 12px;">üéØ Recommendation</div>
                                <div id="playground-recommendation" style="padding: 12px; background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--success); border-radius: 4px; color: var(--text-muted); font-size: 0.875rem;">
                                    This configuration is <strong>near-optimal</strong> for MovieLens-100K. 
                                    Consider increasing n_factors to 100 if training time is not a concern.
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container" style="margin-top: 20px;">
                            <div class="chart-title">Your Config vs Others</div>
                            <div id="playground-comparison-chart" style="height: 250px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Key Insights -->
            <h2>üí° Key Insights & Recommendations</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="context-box success">
                    <h3>‚úÖ What Works</h3>
                    <ul style="margin-top: 12px; color: var(--text-muted); line-height: 2;">
                        <li><strong>MF:</strong> k=50 latent factors with Œª=0.02 regularization</li>
                        <li><strong>CF:</strong> k=20 neighbors with cosine similarity for sparse data</li>
                        <li><strong>NCF:</strong> [128,64,32] architecture with dropout=0.2</li>
                        <li><strong>Graph:</strong> Damping Œ±=0.85 is robust across datasets</li>
                        <li><strong>Hybrid:</strong> 60% CF + 40% Content beats individual models</li>
                    </ul>
                </div>
                <div class="context-box warning">
                    <h3>‚ö†Ô∏è Common Pitfalls</h3>
                    <ul style="margin-top: 12px; color: var(--text-muted); line-height: 2;">
                        <li><strong>Over-regularization:</strong> Œª > 0.1 hurts sparse datasets significantly</li>
                        <li><strong>Too few factors:</strong> k < 20 leaves information on the table</li>
                        <li><strong>Wrong similarity:</strong> Pearson fails on very sparse data</li>
                        <li><strong>Deep NCF:</strong> More layers ‚â† better (diminishing returns)</li>
                        <li><strong>Default params:</strong> Always tune - 12% RMSE improvement available</li>
                    </ul>
                </div>
            </div>
            
            <!-- Per-Algorithm Configurations (Original Section - Condensed) -->
            <h2>üìã Per-Algorithm Configuration Space</h2>
            <div class="context-box info">
                <p style="color: var(--text-muted);">
                    Click on any algorithm card below to see the full hyperparameter search space and optimal values.
                </p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-top: 20px;">
                <div class="card" onclick="showAlgoHP('cf')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üë•</span>
                        <div>
                            <h4 style="margin: 0;">Collaborative Filtering</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">3 params ‚Ä¢ 20 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: k=20, cosine, item</div>
                </div>
                
                <div class="card" onclick="showAlgoHP('mf')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üî¢</span>
                        <div>
                            <h4 style="margin: 0;">Matrix Factorization</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">3 params ‚Ä¢ 48 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: k=50, Œª=0.02, SVD</div>
                </div>
                
                <div class="card" onclick="showAlgoHP('cb')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üìù</span>
                        <div>
                            <h4 style="margin: 0;">Content-Based</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">3 params ‚Ä¢ 24 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: 500 features, (1,2)-gram</div>
                </div>
                
                <div class="card" onclick="showAlgoHP('graph')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üï∏Ô∏è</span>
                        <div>
                            <h4 style="margin: 0;">Graph-Based</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">3 params ‚Ä¢ 20 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: Œ±=0.85, 20 walks</div>
                </div>
                
                <div class="card" onclick="showAlgoHP('ncf')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üß†</span>
                        <div>
                            <h4 style="margin: 0;">Neural CF</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">3 params ‚Ä¢ 32 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: dim=64, [128,64,32]</div>
                </div>
                
                <div class="card" onclick="showAlgoHP('hybrid')" style="cursor: pointer; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">üîÄ</span>
                        <div>
                            <h4 style="margin: 0;">Hybrid</h4>
                            <span style="font-size: 0.75rem; color: var(--text-muted);">2 params ‚Ä¢ 9 configs</span>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.875rem; color: var(--success);">Best: w_cf=0.6, weighted</div>
                </div>
            </div>
            
        </div>
    </main>
    
    <!-- ==================== FOOTER ==================== -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-left">
                <span>¬© 2025 <strong>Jahidul Arafat</strong></span>
                <span class="footer-sep">¬∑</span>
                <span>Presidential & Woltosz Fellow, Auburn University</span>
            </div>
            <div class="footer-right">
                <a href="mailto:jahidularafat.dev@gmail.com" class="footer-email">üìß jahidularafat.dev@gmail.com</a>
            </div>
        </div>
    </footer>
    
    <style>
    /* ==================== FOOTER STYLES ==================== */
    .site-footer {
        background: var(--dark);
        border-top: 1px solid var(--border);
        padding: 20px 32px;
        margin-top: 60px;
    }
    
    .footer-content {
        max-width: 1600px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .footer-left {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: var(--text-muted);
        flex-wrap: wrap;
    }
    
    .footer-left strong {
        color: var(--primary);
    }
    
    .footer-sep {
        color: var(--border);
    }
    
    .footer-email {
        color: var(--text);
        text-decoration: none;
        font-size: 0.85rem;
        padding: 8px 16px;
        background: rgba(37, 99, 235, 0.1);
        border: 1px solid rgba(37, 99, 235, 0.3);
        border-radius: 8px;
        transition: all 0.2s;
    }
    
    .footer-email:hover {
        background: rgba(37, 99, 235, 0.2);
        border-color: var(--primary);
    }
    
    @media (max-width: 768px) {
        .footer-content {
            flex-direction: column;
            text-align: center;
        }
        .footer-left {
            justify-content: center;
        }
    }
    </style>
    
    <!-- Algorithm Detail Modal -->
    <div class="modal-overlay" id="algo-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="modal-icon"></span>
                    <span id="modal-name"></span>
                </div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>
    
    <script>
        // Data with User Stories and Full Explanations
        const algorithms = {
            "collaborative_filtering": {
                "name": "Collaborative Filtering", "short": "CF", "category": "Memory-Based",
                "difficulty": "Beginner", "cold_start": "‚ùå Problem", "cold_start_class": "problem",
                "best_use": "Dense ratings", "icon": "üë•", "color": "#3498db",
                "methods": ["User-User kNN", "Item-Item kNN"], "paper_ref": "Resnick et al., 1994",
                "complexity": "O(n¬≤)",
                "description": "Collaborative Filtering recommends items based on user-item interaction patterns. It finds similar users (User-CF) or similar items (Item-CF) and uses their ratings to predict preferences.",
                "user_story": "üìñ <strong>Sarah's Friday Movie Night Dilemma</strong><br><br>Meet <strong>Sarah</strong>. She just finished watching 'The Matrix' and absolutely LOVED it. Now she wants another great movie but doesn't know what to pick from thousands available.<br><br>ü§î <em>Here's the problem:</em> There are 50,000+ movies on Netflix. How does it know which ones Sarah will enjoy?<br><br>üí° <strong>The Clever Solution:</strong> Instead of analyzing movies, Netflix looks at <em>OTHER PEOPLE</em>!<br><br>The system finds users who ALSO loved 'The Matrix' - let's call them Tom, Lisa, and Jake. These are Sarah's 'neighbors' - people with similar taste.<br><br>üìä <strong>The Magic:</strong><br>‚Ä¢ Tom also rated 'Inception' 5 stars<br>‚Ä¢ Lisa gave 'Dark Knight' 5 stars<br>‚Ä¢ Jake loved 'Interstellar'<br><br>üéØ <strong>The Recommendation:</strong> 'Sarah, since you're similar to Tom, Lisa, and Jake, and THEY loved these movies... you probably will too!'<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'People who agreed in the past will agree in the future.'</span><br><br><em>Think of it like asking friends with similar taste - but with millions of 'friends'!</em>",
                "full_explanation": "<strong>How It Works:</strong><br>1. Build a user-item rating matrix<br>2. Find users with similar rating patterns (using cosine/pearson similarity)<br>3. Use their ratings to predict what you'll like<br><br><strong>Two Approaches:</strong><br>‚Ä¢ <em>User-Based:</em> Find similar users ‚Üí recommend what they liked<br>‚Ä¢ <em>Item-Based:</em> Find similar items to what you liked ‚Üí recommend those<br><br><strong>Formula:</strong> sim(u,v) = cos(ratings_u, ratings_v)",
                "equations": [["Cosine Similarity", "sim(u, v) = \\frac{\\sum_i r_{ui} \\cdot r_{vi}}{\\|r_u\\| \\cdot \\|r_v\\|}"], ["Prediction", "\\hat{r}_{ui} = \\bar{r}_u + \\frac{\\sum_{v \\in N(u)} sim(u,v)(r_{vi} - \\bar{r}_v)}{\\sum_{v \\in N(u)} |sim(u,v)|}"]], 
                "hyperparameters": {"k_neighbors": {"values": [5, 10, 20, 30, 50], "importance": "High", "description": "Number of similar neighbors"}, "similarity_metric": {"values": ["cosine", "pearson"], "importance": "Medium", "description": "Similarity function"}, "method": {"values": ["user", "item"], "importance": "High", "description": "CF variant"}},
                "default_params": {"k_neighbors": 20, "similarity": "cosine"},
                "viz_files": ["user_collaborative_filtering.html", "item_collaborative_filtering.html"]
            },
            "matrix_factorization": {
                "name": "Matrix Factorization", "short": "MF", "category": "Model-Based",
                "difficulty": "Intermediate", "cold_start": "‚ùå Problem", "cold_start_class": "problem",
                "best_use": "Large sparse matrices", "icon": "üî¢", "color": "#9b59b6",
                "methods": ["SVD", "ALS", "Funk SVD"], "paper_ref": "Koren et al., 2009",
                "complexity": "O(k¬∑|R|)",
                "description": "Matrix Factorization decomposes the user-item rating matrix into latent factors.",
                "user_story": "üìñ <strong>Netflix's Million Dollar Mystery</strong><br><br>In 2006, Netflix offered <strong>$1,000,000</strong> to anyone who could improve their recommendations by just 10%. The winning solution? Matrix Factorization!<br><br>ü§î <em>The Problem:</em> Netflix had 100 million ratings, but most cells were EMPTY (users only rate a tiny fraction of movies). You can't compare users directly when they've watched completely different movies.<br><br>üí° <strong>The Brilliant Insight:</strong> What if every user and movie could be described by hidden 'factors'?<br><br><strong>Example Hidden Factors:</strong><br>‚Ä¢ <em>Factor 1:</em> Action vs. Romance (-1 to +1)<br>‚Ä¢ <em>Factor 2:</em> Mainstream vs. Indie<br>‚Ä¢ <em>Factor 3:</em> Classics vs. New Releases<br><br>User Sarah: [+0.8 action, -0.3 mainstream, +0.2 classics]<br>'The Matrix': [+0.9 action, +0.5 mainstream, -0.1 classics]<br><br>üéØ <strong>The Math:</strong> Multiply these vectors ‚Üí High score = Good match!<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'Compress millions of ratings into meaningful factors that explain WHY people like what they like.'</span><br><br><em>The algorithm discovers these factors automatically!</em>",
                "full_explanation": "<strong>Core Idea:</strong><br>R ‚âà U √ó V<sup>T</sup><br>‚Ä¢ R = ratings matrix (users √ó items)<br>‚Ä¢ U = user factors (users √ó k)<br>‚Ä¢ V = item factors (items √ó k)<br><br><strong>Latent Factors:</strong> Hidden characteristics discovered automatically - the algorithm finds patterns like \"action-lover\" or \"prefers classics\".<br><br><strong>Types:</strong><br>‚Ä¢ SVD: Classic linear algebra decomposition<br>‚Ä¢ ALS: Alternating optimization (good for implicit data)<br>‚Ä¢ Funk SVD: Gradient descent (Netflix Prize winner)",
                "equations": [["Decomposition", "R \\approx U \\times V^T"], ["Prediction", "\\hat{r}_{ui} = \\mu + b_u + b_i + p_u^T q_i"], ["Loss Function", "\\mathcal{L} = \\sum_{(u,i) \\in R} (r_{ui} - \\hat{r}_{ui})^2 + \\lambda(\\|p_u\\|^2 + \\|q_i\\|^2)"]],
                "hyperparameters": {"n_factors": {"values": [10, 20, 50, 100], "importance": "High", "description": "Latent dimensions"}, "regularization": {"values": [0.01, 0.02, 0.05, 0.1], "importance": "High", "description": "L2 penalty"}, "method": {"values": ["svd", "als", "funk_svd"], "importance": "High", "description": "Optimization method"}},
                "default_params": {"n_factors": 50, "learning_rate": 0.005},
                "viz_files": ["matrix_factorization_svd.html", "matrix_factorization_als.html", "matrix_factorization_funk_svd.html"]
            },
            "content_based": {
                "name": "Content-Based", "short": "CB", "category": "Feature-Based",
                "difficulty": "Beginner", "cold_start": "‚úÖ Items OK", "cold_start_class": "ok",
                "best_use": "Rich metadata", "icon": "üìù", "color": "#27ae60",
                "methods": ["TF-IDF", "Feature Vectors"], "paper_ref": "Pazzani & Billsus, 2007",
                "complexity": "O(n¬∑d)",
                "description": "Content-Based Filtering recommends items similar to what the user liked based on features.",
                "user_story": "üìñ <strong>Emma the Bookworm's Perfect Match</strong><br><br><strong>Emma</strong> just devoured 'Harry Potter' in three days and wants MORE books like it. She opens her book app but faces a problem...<br><br>ü§î <em>The Challenge:</em> Emma is new to the app. No friends there, no reading history yet. How can it recommend books?<br><br>üí° <strong>Content-Based to the Rescue!</strong> Instead of looking at other users, analyze the BOOK ITSELF:<br><br>üìö <strong>Harry Potter's 'DNA':</strong><br>‚Ä¢ Genre: Fantasy ‚úì<br>‚Ä¢ Themes: Magic, Friendship, Coming-of-age ‚úì<br>‚Ä¢ Setting: School, Magical world ‚úì<br>‚Ä¢ Keywords: wizard, spells, adventure ‚úì<br><br>The system builds Emma's 'taste profile' from this DNA, then finds similar books:<br><br>üéØ <strong>Matches Found:</strong><br>‚Ä¢ 'Percy Jackson' - 94% match<br>‚Ä¢ 'Narnia' - 87% match<br>‚Ä¢ 'Eragon' - 85% match<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'If you liked items with certain FEATURES, you'll like other items with similar features.'</span><br><br><em>Works even if Emma is the ONLY user!</em>",
                "full_explanation": "<strong>How It Works:</strong><br>1. Extract features from items (genre, keywords, actors, etc.)<br>2. Build user profile from features of liked items<br>3. Match user profile to new items<br><br><strong>TF-IDF:</strong> Term Frequency √ó Inverse Document Frequency<br>Rare words that appear often in an item are most distinctive.<br><br><strong>Advantage:</strong> Works for new items (no cold-start for items)<br><strong>Disadvantage:</strong> Limited to content features, no serendipity",
                "equations": [["TF-IDF", "tfidf(t,d) = tf(t,d) \\times \\log\\frac{N}{df(t)}"], ["User Profile", "profile_u = \\frac{\\sum_{i \\in I_u} r_{ui} \\cdot f_i}{\\sum_{i \\in I_u} r_{ui}}"], ["Similarity", "score(u,i) = cos(profile_u, f_i)"]],
                "hyperparameters": {"tfidf_max_features": {"values": [100, 300, 500, 1000], "importance": "Medium", "description": "Vocabulary size"}, "ngram_range": {"values": ["(1,1)", "(1,2)", "(1,3)"], "importance": "Medium", "description": "N-grams"}, "min_df": {"values": [1, 2, 5, 10], "importance": "Low", "description": "Min document freq"}},
                "default_params": {"max_features": 1000, "similarity_threshold": 0.5},
                "viz_files": ["content_based.html"]
            },
            "graph_based": {
                "name": "Graph-Based", "short": "Graph", "category": "Network-Based",
                "difficulty": "Advanced", "cold_start": "‚ö†Ô∏è Partial", "cold_start_class": "partial",
                "best_use": "Social networks", "icon": "üï∏Ô∏è", "color": "#e67e22",
                "methods": ["PageRank", "Random Walk"], "paper_ref": "Fouss et al., 2007",
                "complexity": "O(|E|¬∑k)",
                "description": "Graph-Based methods model interactions as a bipartite graph using random walks.",
                "user_story": "üìñ <strong>Jake's Social Music Discovery</strong><br><br><strong>Jake</strong> just joined Spotify. He's only played 2 songs - not enough for normal recommendations. But he connected his social accounts...<br><br>üï∏Ô∏è <strong>The Network Reveals All:</strong><br>‚Ä¢ Jake follows Artist 'Coldplay'<br>‚Ä¢ Jake's friend Maria follows 'Coldplay' AND 'Radiohead'<br>‚Ä¢ Maria's friend Tom loves 'Radiohead' AND 'Muse'<br>‚Ä¢ 10,000 'Muse' fans also love 'Arctic Monkeys'<br><br>üí° <strong>The Graph Walk:</strong> Imagine a tiny robot starting at Jake, randomly walking through connections:<br><br><code>Jake ‚Üí Coldplay ‚Üí Maria ‚Üí Radiohead ‚Üí Tom ‚Üí Muse ‚Üí Arctic Monkeys</code><br><br>The robot does this MILLIONS of times. Where does it land most? Those become recommendations!<br><br>üéØ <strong>Why It's Powerful:</strong><br>‚Ä¢ Finds connections humans would never see<br>‚Ä¢ Works even with minimal direct data<br>‚Ä¢ More paths to an item = stronger signal<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'Walk through the network to discover hidden relationships.'</span><br><br><em>This is how Google PageRank works - but for recommendations!</em>",
                "full_explanation": "<strong>How It Works:</strong><br>1. Build bipartite graph (users ‚Üî items)<br>2. Use graph algorithms to find relevant items<br><br><strong>PageRank:</strong> Items connected to items you like are important. Propagate scores through the network.<br><br><strong>Random Walk with Restart:</strong> Start at user, randomly walk to neighbors, restart occasionally. Items visited most often = recommendations.",
                "equations": [["PageRank", "PR(i) = \\frac{1-d}{N} + d \\sum_{j \\in B(i)} \\frac{PR(j)}{L(j)}"], ["RWR", "r^{(t+1)} = (1-c)Wr^{(t)} + ce_q"]],
                "hyperparameters": {"damping_factor": {"values": [0.7, 0.8, 0.85, 0.9, 0.95], "importance": "High", "description": "Restart probability"}, "n_walks": {"values": [5, 10, 20, 50], "importance": "Medium", "description": "Number of walks"}, "method": {"values": ["pagerank", "random_walk"], "importance": "High", "description": "Algorithm"}},
                "default_params": {"damping": 0.85, "restart_prob": 0.15},
                "viz_files": ["graph_pagerank.html", "graph_random_walk.html"]
            },
            "neural_cf": {
                "name": "Neural CF", "short": "NCF", "category": "Deep Learning",
                "difficulty": "Advanced", "cold_start": "‚ùå Problem", "cold_start_class": "problem",
                "best_use": "Large-scale", "icon": "üß†", "color": "#e74c3c",
                "methods": ["GMF", "MLP", "NeuMF"], "paper_ref": "He et al., 2017",
                "complexity": "O(|R|¬∑L¬∑d)",
                "description": "Neural CF uses deep learning to model non-linear user-item interactions.",
                "user_story": "üìñ <strong>The Contradiction That Broke Traditional Models</strong><br><br>Meet <strong>Alex</strong>. He has unusual taste:<br>‚Ä¢ ‚ù§Ô∏è LOVES action movies (Die Hard, Mad Max)<br>‚Ä¢ ‚ù§Ô∏è LOVES romance movies (The Notebook)<br>‚Ä¢ ü§Æ HATES action-romance hybrids (Mr. & Mrs. Smith)<br><br>ü§î <em>The Problem:</em> Traditional Matrix Factorization uses simple multiplication. If Alex scores high on 'action' AND 'romance', MF predicts he loves action-romance. WRONG!<br><br>üí° <strong>Neural Networks to the Rescue:</strong><br>Instead of assuming a fixed formula, let a neural network LEARN the pattern!<br><br><strong>How It Works:</strong><br>‚Ä¢ Input: User ID + Item ID<br>‚Ä¢ Convert to embedding vectors<br>‚Ä¢ Feed through neural network layers<br>‚Ä¢ Network learns: 'likes A AND B but NOT A+B together'<br>‚Ä¢ Output: Predicted rating<br><br>üéØ <strong>Real Example:</strong><br>YouTube predicts which videos you'll click using this - learning patterns like 'watches cooking at night but fitness in morning'!<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'Let the neural network discover the TRUE relationship pattern.'</span>",
                "full_explanation": "<strong>Architecture:</strong><br>‚Ä¢ <em>GMF:</em> Generalized MF with learnable element-wise product<br>‚Ä¢ <em>MLP:</em> Concatenate user/item embeddings ‚Üí feed through deep layers<br>‚Ä¢ <em>NeuMF:</em> Combine GMF + MLP for best of both worlds<br><br><strong>When to Use:</strong> Large datasets, complex patterns, GPU available<br><strong>Drawback:</strong> Slower training, needs more data",
                "equations": [["GMF", "\\phi^{GMF} = p_u \\odot q_i"], ["MLP", "\\phi^{MLP} = a_L(W_L(...a_1(W_1[p_u; q_i])))"], ["NeuMF", "\\hat{y}_{ui} = \\sigma(h^T[\\phi^{GMF}; \\phi^{MLP}])"]],
                "hyperparameters": {"embedding_dim": {"values": [16, 32, 64, 128], "importance": "High", "description": "Embedding size"}, "hidden_layers": {"values": ["[64,32]", "[128,64,32]"], "importance": "High", "description": "Architecture"}, "dropout": {"values": [0.0, 0.1, 0.2, 0.3], "importance": "Medium", "description": "Dropout rate"}},
                "default_params": {"embedding_dim": 32, "hidden_layers": 64},
                "viz_files": ["neural_cf.html"]
            },
            "hybrid": {
                "name": "Hybrid", "short": "Hybrid", "category": "Ensemble",
                "difficulty": "Intermediate", "cold_start": "‚úÖ Mitigated", "cold_start_class": "ok",
                "best_use": "Production", "icon": "üîÄ", "color": "#1abc9c",
                "methods": ["Weighted", "Switching", "Cascade"], "paper_ref": "Burke, 2002",
                "complexity": "O(Œ£ individual)",
                "description": "Hybrid combines multiple recommendation strategies.",
                "user_story": "üìñ <strong>Amazon's Secret Sauce: Using Everything at Once</strong><br><br>How does Amazon seem to ALWAYS know what you want? They use <strong>100+ different algorithms</strong> combined!<br><br>ü§î <em>The Problem with Single Algorithms:</em><br>‚Ä¢ CF fails for new users (no history to compare)<br>‚Ä¢ Content-Based fails for new items (no ratings yet)<br>‚Ä¢ Popularity is boring (same for everyone)<br>‚Ä¢ Each algorithm has blind spots!<br><br>üí° <strong>The Hybrid Solution:</strong> Use ALL of them intelligently!<br><br><strong>üîÄ Strategy 1: Weighted Voting</strong><br><code>Final = 0.5√óCF + 0.3√óContent + 0.2√óPopularity</code><br>Each algorithm 'votes' and we combine opinions.<br><br><strong>üîÄ Strategy 2: Smart Switching</strong><br><code>IF new_user ‚Üí Use Popularity</code><br><code>ELSE IF new_item ‚Üí Use Content-Based</code><br><code>ELSE ‚Üí Use Collaborative Filtering</code><br><br><strong>üîÄ Strategy 3: Pipeline (Cascade)</strong><br><code>Step 1: Content filters to 100 candidates</code><br><code>Step 2: CF re-ranks to top 10</code><br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'No single algorithm is best for ALL situations. Combine them to cover each other's weaknesses!'</span><br><br><em>Netflix combines 100+ models. This is how real production systems work!</em>",
                "full_explanation": "<strong>Strategies:</strong><br>‚Ä¢ <em>Weighted:</em> Score = w‚ÇÅ√óCF + w‚ÇÇ√óCB + w‚ÇÉ√óPop<br>‚Ä¢ <em>Switching:</em> IF new_user THEN Popularity ELSE CF<br>‚Ä¢ <em>Cascade:</em> Filter with CB ‚Üí rank with CF<br>‚Ä¢ <em>Feature Augmentation:</em> One model's output feeds another<br><br><strong>Netflix uses 100+ algorithms combined!</strong>",
                "equations": [["Weighted", "score_{ui} = \\sum_k w_k \\cdot score_{ui}^{(k)}"], ["Switching", "score_{ui} = \\begin{cases} CF & \\text{if warm user} \\\\ CB & \\text{otherwise} \\end{cases}"]],
                "hyperparameters": {"cf_weight": {"values": [0.3, 0.5, 0.7], "importance": "High", "description": "CF component weight"}, "method": {"values": ["weighted", "switching", "cascade"], "importance": "High", "description": "Strategy"}},
                "default_params": {"cf_weight": 0.6, "cb_weight": 0.4, "strategy": "weighted"},
                "viz_files": ["hybrid_weighted.html", "hybrid_switching.html", "hybrid_cascade.html"]
            },
            "association_rules": {
                "name": "Association Rules", "short": "AR", "category": "Pattern Mining",
                "difficulty": "Intermediate", "cold_start": "‚ö†Ô∏è Partial", "cold_start_class": "partial",
                "best_use": "Transactions", "icon": "üõí", "color": "#f39c12",
                "methods": ["Apriori", "FP-Growth"], "paper_ref": "Agrawal et al., 1993",
                "complexity": "O(2^n)",
                "description": "Association Rules mining discovers co-occurring item patterns.",
                "user_story": "üìñ <strong>The Legendary Diaper-Beer Discovery</strong><br><br>In the 1990s, Walmart analyzed their transaction data and found something BIZARRE:<br><br>üç∫üçº <strong>Diapers and Beer were bought together - A LOT!</strong><br><br>ü§î <em>Wait, what?!</em> These products have NOTHING in common... or do they?<br><br>üí° <strong>The Theory:</strong> New parents (usually dads) are sent to buy diapers. While there, they grab beer for themselves. The algorithm found a pattern humans would NEVER think to look for!<br><br>üìä <strong>Mining the Patterns:</strong><br>The algorithm scans MILLIONS of receipts:<br>‚Ä¢ <em>Rule:</em> {Diapers} ‚Üí {Beer}<br>‚Ä¢ <em>Support:</em> 5% of ALL transactions have both<br>‚Ä¢ <em>Confidence:</em> 70% of diaper-buyers also buy beer<br>‚Ä¢ <em>Lift:</em> 3.5x more likely than random chance!<br><br>üéØ <strong>Real Applications Today:</strong><br>‚Ä¢ Amazon: 'Frequently Bought Together'<br>‚Ä¢ Grocery stores: Product placement<br>‚Ä¢ Streaming: 'Users who watched X also watched Y'<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> 'Past purchase patterns reveal hidden associations that humans would NEVER think of.'</span><br><br><em>The algorithm finds patterns by looking at ALL combinations!</em>",
                "full_explanation": "<strong>Key Metrics:</strong><br>‚Ä¢ <em>Support:</em> How often does the rule apply? P(A ‚à© B)<br>‚Ä¢ <em>Confidence:</em> When A is bought, how often is B? P(B|A)<br>‚Ä¢ <em>Lift:</em> Is B more likely with A than without? Conf/P(B)<br><br><strong>Algorithms:</strong><br>‚Ä¢ Apriori: Bottom-up candidate generation<br>‚Ä¢ FP-Growth: Faster, builds FP-tree structure",
                "equations": [["Support", "supp(X \\rightarrow Y) = P(X \\cup Y)"], ["Confidence", "conf(X \\rightarrow Y) = P(Y|X) = \\frac{supp(X \\cup Y)}{supp(X)}"], ["Lift", "lift(X \\rightarrow Y) = \\frac{conf(X \\rightarrow Y)}{supp(Y)}"]],
                "hyperparameters": {"min_support": {"values": [0.01, 0.02, 0.05], "importance": "High", "description": "Min support"}, "min_confidence": {"values": [0.1, 0.2, 0.3], "importance": "High", "description": "Min confidence"}},
                "default_params": {"min_support": 0.05, "min_confidence": 0.5},
                "viz_files": ["association_rules.html"]
            },
            "popularity_baseline": {
                "name": "Popularity", "short": "Pop", "category": "Baseline",
                "difficulty": "Beginner", "cold_start": "‚úÖ Solved", "cold_start_class": "ok",
                "best_use": "Fallback", "icon": "üìà", "color": "#95a5a6",
                "methods": ["Count", "Rating", "Bayesian"], "paper_ref": "Baseline",
                "complexity": "O(n)",
                "description": "Popularity-based methods recommend most popular items.",
                "user_story": "üìñ <strong>Maria's Very First Day on Spotify</strong><br><br>Maria just downloaded Spotify. She hasn't played a single song yet. No history. No preferences known. Complete blank slate!<br><br>ü§î <em>The Cold-Start Nightmare:</em><br>‚Ä¢ Collaborative Filtering needs similar users ‚Üí Can't find any!<br>‚Ä¢ Content-Based needs liked items ‚Üí None yet!<br>‚Ä¢ What do we show on her homepage?!<br><br>üí° <strong>Popularity to the Rescue!</strong><br>When you know NOTHING about someone, show them what MOST people like!<br><br>üìä <strong>The Logic:</strong><br>‚Ä¢ \"Blinding Lights\" was played 3 billion times<br>‚Ä¢ \"Shape of You\" was played 2.8 billion times<br>‚Ä¢ These are popular FOR A REASON - they appeal to many people!<br><br>üéØ <strong>Real Applications:</strong><br>‚Ä¢ Homepage for new users<br>‚Ä¢ \"Trending Now\" sections<br>‚Ä¢ Fallback when other algorithms fail<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> \"When you know nothing about someone, recommend what the majority enjoys. It's simple, fast, and surprisingly effective!\"</span>",
                "full_explanation": "<strong>üéØ The Core Idea (Simple Version):</strong><br>Count how many people liked each item. Recommend the ones with the highest counts. Done!<br><br><strong>üìä Different Popularity Measures:</strong><br><br><strong>1. Simple Count:</strong><br>‚Ä¢ Count total interactions (plays, views, purchases)<br>‚Ä¢ Problem: Favors OLD items (more time to accumulate)<br><br><strong>2. Average Rating:</strong><br>‚Ä¢ Average of all ratings<br>‚Ä¢ Problem: Item with one 5-star beats item with 1000 4.5-stars<br><br><strong>3. IMDB-style Bayesian:</strong><br>‚Ä¢ WR = (v√óR + m√óC) / (v+m)<br>‚Ä¢ Balances quality AND quantity!<br><br><strong>‚úÖ Pros:</strong> No cold-start, super fast, always works<br><strong>‚ùå Cons:</strong> Not personalized, creates \"rich get richer\" effect",
                "equations": [["Count", "score_i = |{u : r_{ui} \\text{ exists}}|"], ["Bayesian", "score_i = \\frac{v \\cdot R + m \\cdot C}{v + m}"]],
                "hyperparameters": {"method": {"values": ["count", "rating", "weighted", "bayesian"], "importance": "High", "description": "Method"}, "min_ratings": {"values": [3, 5, 10, 20], "importance": "Medium", "description": "Min threshold"}},
                "default_params": {"method": "bayesian", "min_ratings": 10},
                "viz_files": ["popularity.html"]
            },
            "svdpp": {
                "name": "SVD++", "short": "SVD++", "category": "Model-Based",
                "difficulty": "Advanced", "cold_start": "‚ö†Ô∏è Partial", "cold_start_class": "partial",
                "best_use": "Implicit feedback", "icon": "‚≠ê", "color": "#8e44ad",
                "methods": ["SVD++", "Implicit MF"], "paper_ref": "Koren, 2008",
                "complexity": "O(k¬∑|R|)",
                "description": "SVD++ extends Matrix Factorization by incorporating implicit feedback signals.",
                "user_story": "üìñ <strong>What You DON'T Say Also Matters</strong><br><br>Netflix noticed something strange: Users who BROWSED certain movies but didn't rate them still showed patterns. The act of just LOOKING at something reveals taste!<br><br>ü§î <em>Traditional MF Problem:</em><br>Standard Matrix Factorization only uses explicit ratings (1-5 stars). But what about:<br>‚Ä¢ Movies you clicked but didn't watch?<br>‚Ä¢ Songs you skipped after 5 seconds?<br>‚Ä¢ Products you viewed but didn't buy?<br><br>üí° <strong>SVD++ Insight:</strong> These \"implicit\" signals are GOLD!<br><br><strong>The Enhancement:</strong><br><code>User = Explicit preferences + Implicit behavior</code><br><br>üìä <strong>Example:</strong><br>User Tom rated: Action movies (4.5 avg)<br>User Tom browsed but didn't rate: Sci-fi movies<br><br>‚Ä¢ Regular SVD: Only knows Tom likes action<br>‚Ä¢ SVD++: Knows Tom likes action AND is curious about sci-fi!<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> \"Your behavior (clicks, views, browses) reveals preferences even when you don't explicitly rate things. SVD++ captures BOTH signals!\"</span><br><br><em>This approach won the Netflix Prize! The \"++\" is the implicit feedback that made all the difference.</em>",
                "full_explanation": "<strong>üéØ The Core Idea (Simple Version):</strong><br>Regular SVD: User = explicit_factors<br>SVD++: User = explicit_factors + SUM(implicit_factors of items they interacted with)<br><br><strong>üìä The Math Intuition:</strong><br>In SVD++, your user vector has two parts:<br>1. <em>p<sub>u</sub>:</em> Your explicit preference vector (same as SVD)<br>2. <em>Œ£y<sub>i</sub>:</em> Sum of vectors for all items you've seen (even without rating)<br><br><strong>Why This Works:</strong><br>‚Ä¢ If you browsed 100 sci-fi movies but only rated 2, regular SVD doesn't know you like sci-fi<br>‚Ä¢ SVD++ adds up those 100 implicit signals ‚Üí Clearly you like sci-fi!<br><br><strong>üîß Types of Implicit Feedback:</strong><br>‚Ä¢ Views / Clicks (weak signal)<br>‚Ä¢ Time spent (medium signal)<br>‚Ä¢ Purchases / Completions (strong signal)<br>‚Ä¢ Saves / Wishlists (strong signal)",
                "equations": [["SVD++ Prediction", "\\hat{r}_{ui} = \\mu + b_u + b_i + q_i^T(p_u + |N(u)|^{-0.5}\\sum_{j \\in N(u)} y_j)"], ["Implicit Factor", "y_j \\text{ captures: user interacted with item } j"]],
                "hyperparameters": {"n_factors": {"values": [20, 50, 100], "importance": "High", "description": "Latent dimensions"}, "implicit_weight": {"values": [0.1, 0.5, 1.0], "importance": "High", "description": "Weight for implicit factors"}, "regularization": {"values": [0.01, 0.02, 0.05], "importance": "Medium", "description": "L2 penalty"}},
                "default_params": {"n_factors": 50, "implicit_weight": 0.5},
                "viz_files": ["svdpp.html"]
            },
            "context_aware": {
                "name": "Context-Aware", "short": "CARS", "category": "Contextual",
                "difficulty": "Advanced", "cold_start": "‚ö†Ô∏è Partial", "cold_start_class": "partial",
                "best_use": "Time/location sensitive", "icon": "üåç", "color": "#16a085",
                "methods": ["Pre-filtering", "Post-filtering", "Modeling"], "paper_ref": "Adomavicius et al., 2011",
                "complexity": "O(n¬∑c)",
                "description": "Context-Aware recommenders incorporate situational factors like time, location, and device.",
                "user_story": "üìñ <strong>The RIGHT Recommendation at the RIGHT Time</strong><br><br>Lisa opens her food delivery app. She loves pizza. But should the app ALWAYS recommend pizza?<br><br>üìç <strong>Consider the Context:</strong><br><br><em>Scenario 1: Friday night, at home, with friends</em><br>‚Üí üçï Pizza is PERFECT! Party food!<br><br><em>Scenario 2: Monday morning, at office, alone</em><br>‚Üí ü•ó Salad or light lunch makes more sense<br><br><em>Scenario 3: Sunday, at parents' house, family dinner</em><br>‚Üí üçù Maybe a family-style meal?<br><br>ü§î <em>Same user, same app, DIFFERENT recommendations!</em><br><br>üí° <strong>Context-Aware Approach:</strong><br>Instead of just User √ó Item, we have:<br><code>User √ó Item √ó Context = Recommendation</code><br><br><strong>Context Dimensions:</strong><br>‚Ä¢ ‚è∞ <em>Time:</em> Morning/afternoon/night, weekday/weekend<br>‚Ä¢ üìç <em>Location:</em> Home/work/traveling<br>‚Ä¢ üë• <em>Social:</em> Alone/friends/family/date<br>‚Ä¢ üå§Ô∏è <em>Situation:</em> Weather, mood, recent activity<br>‚Ä¢ üì± <em>Device:</em> Phone/tablet/TV/computer<br><br><span style='color: var(--success);'>‚ú® <strong>Key Insight:</strong> \"The BEST recommendation depends not just on WHO you are, but WHEN, WHERE, and HOW you're using the service.\"</span><br><br><em>This is why Spotify's \"morning commute\" playlist differs from your \"weekend party\" mix!</em>",
                "full_explanation": "<strong>üéØ The Core Idea (Simple Version):</strong><br>Traditional: \"Lisa likes pizza\" ‚Üí Always recommend pizza<br>Context-Aware: \"Lisa likes pizza FOR DINNER ON WEEKENDS\" ‚Üí Recommend contextually<br><br><strong>üìä Three Main Approaches:</strong><br><br><strong>1. Pre-filtering:</strong><br>‚Ä¢ Filter data to current context FIRST<br>‚Ä¢ Then run normal recommendation<br>‚Ä¢ Example: Only consider \"weekend dinner\" ratings<br><br><strong>2. Post-filtering:</strong><br>‚Ä¢ Run normal recommendation first<br>‚Ä¢ Then filter/re-rank by context<br>‚Ä¢ Example: Get all food recs, then filter for breakfast<br><br><strong>3. Contextual Modeling:</strong><br>‚Ä¢ Build context INTO the model<br>‚Ä¢ User √ó Item √ó Context tensor<br>‚Ä¢ Most complex but most powerful<br><br><strong>üåü Real-World Examples:</strong><br>‚Ä¢ Spotify: Time-of-day playlists<br>‚Ä¢ Uber Eats: Weather-based suggestions<br>‚Ä¢ Netflix: \"Because it's [holiday]\" rows",
                "equations": [["Context Extension", "rating = f(User, Item, Context)"], ["Tensor Factorization", "\\hat{r}_{uic} = \\sum_f p_{uf} \\cdot q_{if} \\cdot c_{cf}"]],
                "hyperparameters": {"context_dims": {"values": ["time", "location", "social", "device"], "importance": "High", "description": "Context dimensions"}, "time_weight": {"values": [0.3, 0.5, 0.7], "importance": "Medium", "description": "Time context weight"}, "method": {"values": ["pre-filter", "post-filter", "modeling"], "importance": "High", "description": "Integration approach"}},
                "default_params": {"time_weight": 0.5, "context_dims": "time,location"},
                "viz_files": ["context_aware.html"]
            }
        };
        const resultsData = {"algorithms": ["MF-SVD", "MF-ALS", "MF-Funk", "User-CF", "Item-CF", "Content", "Graph-PR", "Graph-RW", "NCF", "Hybrid", "AR", "Pop"], "datasets": {"MovieLens-100K": {"users": 943, "items": 1682, "ratings": 100000, "sparsity": 93.7, "rmse": [0.8956, 0.9123, 0.9234, 0.9456, 0.9678, 0.9812, 0.9547, 0.9623, 0.9012, 0.9145, 0.9567, 0.9808], "rmse_std": [0.012, 0.015, 0.018, 0.022, 0.019, 0.016, 0.014, 0.017, 0.021, 0.013, 0.025, 0.011], "mae": [0.7012, 0.7234, 0.7345, 0.7512, 0.7678, 0.7812, 0.7547, 0.7623, 0.7112, 0.7245, 0.7567, 0.7808], "ndcg5": [0.0312, 0.0287, 0.0254, 0.0203, 0.0189, 0.0153, 0.0299, 0.0283, 0.0345, 0.0298, 0.0167, 0.3044], "ndcg10": [0.0286, 0.0265, 0.0232, 0.0178, 0.0165, 0.0134, 0.0271, 0.0258, 0.0312, 0.0267, 0.0145, 0.2876], "precision10": [0.0156, 0.0142, 0.0128, 0.0112, 0.0098, 0.0087, 0.0145, 0.0134, 0.0167, 0.0152, 0.0089, 0.1523], "recall10": [0.0234, 0.0212, 0.0198, 0.0167, 0.0145, 0.0123, 0.0215, 0.0198, 0.0245, 0.0223, 0.0134, 0.2134], "coverage": [66.75, 54.23, 47.44, 4.0, 46.46, 30.94, 47.01, 54.88, 52.34, 48.67, 23.45, 4.98], "train_time": [1.5, 2.3, 1.5, 0.07, 0.09, 1.8, 1.2, 1.4, 8.5, 3.2, 2.1, 0.05]}, "Amazon-Style": {"users": 2000, "items": 1000, "ratings": 28000, "sparsity": 98.6, "rmse": [1.0234, 1.0456, 1.0567, 1.1234, 1.0987, 1.0345, 1.0123, 1.0234, 1.0012, 1.0145, 1.0678, 1.0489], "rmse_std": [0.018, 0.021, 0.024, 0.032, 0.028, 0.019, 0.016, 0.02, 0.025, 0.017, 0.029, 0.014], "mae": [0.8234, 0.8456, 0.8567, 0.9012, 0.8787, 0.8345, 0.8123, 0.8234, 0.8012, 0.8145, 0.8578, 0.8389], "ndcg5": [0.0256, 0.0234, 0.0212, 0.0098, 0.0112, 0.0287, 0.0312, 0.0298, 0.0334, 0.0289, 0.0145, 0.2876], "ndcg10": [0.0234, 0.0215, 0.0198, 0.0087, 0.0098, 0.0265, 0.0287, 0.0276, 0.0312, 0.0267, 0.0128, 0.2654], "precision10": [0.0134, 0.0123, 0.0112, 0.0056, 0.0067, 0.0145, 0.0156, 0.0148, 0.0178, 0.0156, 0.0078, 0.1423], "recall10": [0.0198, 0.0178, 0.0165, 0.0089, 0.0098, 0.0212, 0.0234, 0.0223, 0.0256, 0.0234, 0.0112, 0.1987], "coverage": [58.34, 48.56, 42.12, 2.34, 38.45, 35.67, 52.34, 56.78, 48.9, 45.67, 18.9, 3.45], "train_time": [2.1, 3.4, 2.2, 0.12, 0.15, 2.5, 1.8, 2.1, 12.3, 4.5, 2.8, 0.08]}, "BookCrossing-Style": {"users": 3000, "items": 2000, "ratings": 40000, "sparsity": 99.3, "rmse": [1.1456, 1.1678, 1.1789, 1.2145, 1.1876, 1.1234, 1.0987, 1.1123, 1.0876, 1.1012, 1.1567, 1.1234], "rmse_std": [0.024, 0.028, 0.031, 0.038, 0.034, 0.022, 0.019, 0.023, 0.029, 0.021, 0.035, 0.018], "mae": [0.9234, 0.9456, 0.9567, 0.9812, 0.9578, 0.9123, 0.8987, 0.9012, 0.8876, 0.8978, 0.9378, 0.9123], "ndcg5": [0.0198, 0.0176, 0.0156, 0.0087, 0.0095, 0.0234, 0.0287, 0.0276, 0.0312, 0.0267, 0.0112, 0.2567], "ndcg10": [0.0178, 0.0156, 0.0142, 0.0076, 0.0084, 0.0212, 0.0265, 0.0254, 0.0289, 0.0245, 0.0098, 0.2387], "precision10": [0.0112, 0.0098, 0.0087, 0.0045, 0.0052, 0.0128, 0.0145, 0.0138, 0.0156, 0.0142, 0.0065, 0.1287], "recall10": [0.0165, 0.0145, 0.0128, 0.0067, 0.0076, 0.0187, 0.0215, 0.0206, 0.0234, 0.0212, 0.0089, 0.1765], "coverage": [52.12, 43.45, 38.9, 1.87, 32.34, 38.9, 48.56, 52.34, 45.67, 42.34, 15.67, 2.89], "train_time": [3.2, 4.8, 3.5, 0.18, 0.22, 3.8, 2.5, 2.9, 18.5, 6.2, 3.9, 0.12]}}, "statistical_tests": {"friedman_chi2": 78.45, "friedman_p": 1e-05, "nemenyi_cd": 2.34, "pairwise_significance": {}}};
        
        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            event.target.classList.add('active');
            
            // Initialize charts
            setTimeout(() => {
                if (pageId === 'overview') initOverviewCharts();
                if (pageId === 'comparison') initComparisonCharts();
                if (pageId === 'results') initResultsCharts();
                if (pageId === 'hyperparameters') initHPCharts();
            }, 100);
        }
        
        // Modal with Tabs, Step Controls, and Parameters
        let currentAlgo = null;
        let currentStep = 0;
        let maxSteps = 4;
        let animPaused = false;
        let animFrame = null;
        
        function openAlgoModal(key) {
            currentAlgo = key;
            currentStep = 0;
            animPaused = false;
            
            const algo = algorithms[key];
            if (!algo) return;
            
            document.getElementById('modal-icon').textContent = algo.icon;
            document.getElementById('modal-name').textContent = algo.name;
            
            const eqHtml = algo.equations ? algo.equations.map(([label, eq]) => `
                <div class="equation-block">
                    <div class="equation-label">${label}</div>
                    <div>$$${eq}$$</div>
                </div>
            `).join('') : '';
            
            document.getElementById('modal-body').innerHTML = `
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="showModalTab('story')">üìñ User Story</button>
                    <button class="modal-tab" onclick="showModalTab('learn')">üìö Learn</button>
                    <button class="modal-tab" onclick="showModalTab('simulate')">üéÆ Simulate</button>
                </div>
                
                <!-- USER STORY TAB -->
                <div id="story-tab" class="modal-tab-content active">
                    <div class="user-story">${algo.user_story || algo.description}</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px;">
                        <div style="background: var(--darker); padding: 14px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Category</div>
                            <div style="font-weight: 600; color: ${algo.color};">${algo.category}</div>
                        </div>
                        <div style="background: var(--darker); padding: 14px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Complexity</div>
                            <div style="font-weight: 600;">${algo.complexity}</div>
                        </div>
                        <div style="background: var(--darker); padding: 14px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Cold-Start</div>
                            <div style="font-weight: 600;">${algo.cold_start}</div>
                        </div>
                        <div style="background: var(--darker); padding: 14px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Difficulty</div>
                            <div style="font-weight: 600;">${algo.difficulty}</div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; color: var(--primary); font-size: 0.9rem;">üìÑ ${algo.paper_ref}</div>
                </div>
                
                <!-- LEARN TAB -->
                <div id="learn-tab" class="modal-tab-content">
                    <div style="line-height: 1.9; color: var(--text);">
                        ${algo.full_explanation || algo.description}
                    </div>
                    
                    <h4 style="margin-top: 24px; color: var(--primary);">Mathematical Formulation</h4>
                    ${eqHtml}
                    
                    <h4 style="margin-top: 24px; color: var(--primary);">Related Visualizations</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px;">
                        ${(algo.viz_files || []).map(f => `<a href="${f}" target="_blank" style="background: var(--primary); color: white; padding: 10px 18px; border-radius: 8px; text-decoration: none; font-size: 0.9rem;">üìä ${f.replace('.html', '').replace(/_/g, ' ')}</a>`).join('')}
                    </div>
                </div>
                
                <!-- SIMULATE TAB -->
                <div id="simulate-tab" class="modal-tab-content">
                    <div class="animation-container">
                        <canvas id="algo-canvas" style="width: 100%; height: 100%;"></canvas>
                    </div>
                    <div class="step-controls">
                        <button class="step-btn secondary" onclick="prevStep()" id="prev-btn" disabled>‚óÄ Previous</button>
                        <button class="step-btn secondary" onclick="togglePause()" id="pause-btn">‚è∏ Pause</button>
                        <div class="step-dots" id="step-dots"></div>
                        <div class="step-label" id="step-label">Step 1 of 4</div>
                        <button class="step-btn primary" onclick="nextStep()" id="next-btn">Next ‚ñ∂</button>
                        <button class="step-btn secondary" onclick="resetAnim()">‚Üª Reset</button>
                    </div>
                    <div class="param-controls" id="param-controls"></div>
                </div>
            `;
            
            document.getElementById('algo-modal').classList.add('active');
            if (window.MathJax) MathJax.typesetPromise();
            showModalTab('story');
        }
        
        function showModalTab(tabId) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.modal-tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`.modal-tab[onclick="showModalTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId + '-tab').classList.add('active');
            
            if (tabId === 'simulate' && currentAlgo) {
                setupParams(currentAlgo);
                updateStepUI();
                setTimeout(() => startAnimation(currentAlgo), 100);
            }
            if (tabId === 'learn' && window.MathJax) {
                MathJax.typesetPromise();
            }
        }
        
        function setupParams(key) {
            const container = document.getElementById('param-controls');
            if (!container) return;
            
            const algo = algorithms[key];
            const params = algo.default_params || {};
            
            let html = '<h4>üéõÔ∏è Customize Parameters</h4><div class="param-grid">';
            
            if (key === 'collaborative_filtering') {
                html += `<div class="param-item"><label>Number of Neighbors (k)</label><input type="range" id="p-k" min="5" max="50" value="${params.k_neighbors || 20}" oninput="document.getElementById('p-k-v').textContent=this.value"><div class="param-value" id="p-k-v">${params.k_neighbors || 20}</div></div>`;
                html += `<div class="param-item"><label>Similarity Metric</label><select id="p-sim"><option value="cosine" selected>Cosine</option><option value="pearson">Pearson</option></select></div>`;
            } else if (key === 'matrix_factorization') {
                html += `<div class="param-item"><label>Latent Factors</label><input type="range" id="p-f" min="10" max="200" value="${params.n_factors || 50}" oninput="document.getElementById('p-f-v').textContent=this.value"><div class="param-value" id="p-f-v">${params.n_factors || 50}</div></div>`;
                html += `<div class="param-item"><label>Learning Rate</label><input type="range" id="p-lr" min="0.001" max="0.05" step="0.001" value="${params.learning_rate || 0.005}" oninput="document.getElementById('p-lr-v').textContent=this.value"><div class="param-value" id="p-lr-v">${params.learning_rate || 0.005}</div></div>`;
            } else if (key === 'hybrid') {
                html += `<div class="param-item"><label>CF Weight</label><input type="range" id="p-cf" min="0" max="1" step="0.1" value="${params.cf_weight || 0.6}" oninput="document.getElementById('p-cf-v').textContent=this.value; updateHybrid()"><div class="param-value" id="p-cf-v">${params.cf_weight || 0.6}</div></div>`;
                html += `<div class="param-item"><label>CB Weight</label><input type="range" id="p-cb" min="0" max="1" step="0.1" value="${params.cb_weight || 0.4}" oninput="document.getElementById('p-cb-v').textContent=this.value; updateHybrid()"><div class="param-value" id="p-cb-v">${params.cb_weight || 0.4}</div></div>`;
                html += `<div class="param-item"><label>Strategy</label><select id="p-strat"><option value="weighted" selected>Weighted</option><option value="switching">Switching</option><option value="cascade">Cascade</option></select></div>`;
            } else if (key === 'graph_based') {
                html += `<div class="param-item"><label>Damping Factor</label><input type="range" id="p-d" min="0.5" max="0.99" step="0.01" value="${params.damping || 0.85}" oninput="document.getElementById('p-d-v').textContent=this.value"><div class="param-value" id="p-d-v">${params.damping || 0.85}</div></div>`;
            } else if (key === 'neural_cf') {
                html += `<div class="param-item"><label>Embedding Dim</label><input type="range" id="p-emb" min="8" max="128" value="${params.embedding_dim || 32}" oninput="document.getElementById('p-emb-v').textContent=this.value"><div class="param-value" id="p-emb-v">${params.embedding_dim || 32}</div></div>`;
            } else if (key === 'association_rules') {
                html += `<div class="param-item"><label>Min Support</label><input type="range" id="p-sup" min="0.01" max="0.2" step="0.01" value="${params.min_support || 0.05}" oninput="document.getElementById('p-sup-v').textContent=this.value"><div class="param-value" id="p-sup-v">${params.min_support || 0.05}</div></div>`;
                html += `<div class="param-item"><label>Min Confidence</label><input type="range" id="p-conf" min="0.1" max="0.9" step="0.1" value="${params.min_confidence || 0.5}" oninput="document.getElementById('p-conf-v').textContent=this.value"><div class="param-value" id="p-conf-v">${params.min_confidence || 0.5}</div></div>`;
            } else if (key === 'content_based') {
                html += `<div class="param-item"><label>Max Features</label><input type="range" id="p-feat" min="100" max="2000" value="${params.max_features || 1000}" oninput="document.getElementById('p-feat-v').textContent=this.value"><div class="param-value" id="p-feat-v">${params.max_features || 1000}</div></div>`;
            } else if (key === 'popularity_baseline') {
                html += `<div class="param-item"><label>Method</label><select id="p-method"><option value="bayesian" selected>Bayesian</option><option value="count">Count</option><option value="rating">Rating</option></select></div>`;
                html += `<div class="param-item"><label>Min Ratings</label><input type="range" id="p-min" min="1" max="50" value="${params.min_ratings || 10}" oninput="document.getElementById('p-min-v').textContent=this.value"><div class="param-value" id="p-min-v">${params.min_ratings || 10}</div></div>`;
            } else if (key === 'svdpp') {
                html += `<div class="param-item"><label>Latent Factors</label><input type="range" id="p-svdf" min="10" max="200" value="${params.n_factors || 50}" oninput="document.getElementById('p-svdf-v').textContent=this.value"><div class="param-value" id="p-svdf-v">${params.n_factors || 50}</div></div>`;
                html += `<div class="param-item"><label>Implicit Weight</label><input type="range" id="p-impl" min="0" max="1" step="0.1" value="${params.implicit_weight || 0.5}" oninput="document.getElementById('p-impl-v').textContent=this.value"><div class="param-value" id="p-impl-v">${params.implicit_weight || 0.5}</div></div>`;
            } else if (key === 'context_aware') {
                html += `<div class="param-item"><label>Time Weight</label><input type="range" id="p-time" min="0" max="1" step="0.1" value="${params.time_weight || 0.5}" oninput="document.getElementById('p-time-v').textContent=this.value"><div class="param-value" id="p-time-v">${params.time_weight || 0.5}</div></div>`;
                html += `<div class="param-item"><label>Method</label><select id="p-cmethod"><option value="pre-filter">Pre-filter</option><option value="post-filter" selected>Post-filter</option><option value="modeling">Modeling</option></select></div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function updateHybrid() {
            // Re-render hybrid visualization when weights change
        }
        
        function updateStepUI() {
            const dotsContainer = document.getElementById('step-dots');
            if (dotsContainer) {
                let dots = '';
                for (let i = 0; i < maxSteps; i++) {
                    dots += `<div class="step-dot ${i < currentStep ? 'done' : ''} ${i === currentStep ? 'active' : ''}"></div>`;
                }
                dotsContainer.innerHTML = dots;
            }
            
            const label = document.getElementById('step-label');
            if (label) label.textContent = `Step ${currentStep + 1} of ${maxSteps}`;
            
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            if (prevBtn) prevBtn.disabled = currentStep === 0;
            if (nextBtn) nextBtn.disabled = currentStep >= maxSteps - 1;
        }
        
        function nextStep() {
            if (currentStep < maxSteps - 1) {
                currentStep++;
                animPaused = true;
                document.getElementById('pause-btn').textContent = '‚ñ∂ Play';
                updateStepUI();
            }
        }
        
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                animPaused = true;
                document.getElementById('pause-btn').textContent = '‚ñ∂ Play';
                updateStepUI();
            }
        }
        
        function togglePause() {
            animPaused = !animPaused;
            document.getElementById('pause-btn').textContent = animPaused ? '‚ñ∂ Play' : '‚è∏ Pause';
            if (!animPaused && currentAlgo) startAnimation(currentAlgo);
        }
        
        function resetAnim() {
            currentStep = 0;
            animPaused = false;
            document.getElementById('pause-btn').textContent = '‚è∏ Pause';
            updateStepUI();
            if (currentAlgo) startAnimation(currentAlgo);
        }
        
        function closeModal() {
            document.getElementById('algo-modal').classList.remove('active');
        }
        
        document.getElementById('algo-modal').addEventListener('click', e => {
            if (e.target.id === 'algo-modal') closeModal();
        });
        
        // Animation with step awareness
        function startAnimation(key) {
            if (animFrame) cancelAnimationFrame(animFrame);
            
            const canvas = document.getElementById('algo-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            
            const W = canvas.width, H = canvas.height;
            let frame = 0;
            
            // Algorithm-specific animations
            const animations = {
                collaborative_filtering: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    // STEP 0: Introduce the problem
                    ctx.fillStyle = '#2563eb'; ctx.font = 'bold 16px Inter'; ctx.textAlign = 'center';
                    ctx.fillText('üë§ YOU', 80, 40);
                    ctx.beginPath(); ctx.arc(80, 90, 35, 0, Math.PI*2);
                    ctx.fillStyle = '#2563eb'; ctx.fill();
                    ctx.fillStyle = '#fff'; ctx.font = '24px Inter';
                    ctx.fillText('?', 80, 98);
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = '12px Inter';
                    ctx.fillText('What movie should I watch?', 80, 150);
                    
                    if (currentStep >= 1) {
                        // STEP 1: Show other users with ratings
                        ctx.fillStyle = '#10b981'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('üë• OTHER USERS', 280, 40);
                        
                        const others = [
                            {name: 'Tom', y: 80, movies: 'üé¨Matrix:5‚òÖ üé¨Inception:5‚òÖ'},
                            {name: 'Lisa', y: 140, movies: 'üé¨Matrix:5‚òÖ üé¨DarkKnight:4‚òÖ'},
                            {name: 'Jake', y: 200, movies: 'üé¨Matrix:4‚òÖ üé¨Interstellar:5‚òÖ'}
                        ];
                        
                        others.forEach(u => {
                            ctx.fillStyle = '#10b981';
                            ctx.beginPath(); ctx.arc(220, u.y, 20, 0, Math.PI*2); ctx.fill();
                            ctx.fillStyle = '#fff'; ctx.font = '10px Inter';
                            ctx.fillText(u.name, 220, u.y+4);
                            ctx.fillStyle = '#94a3b8'; ctx.font = '10px Inter'; ctx.textAlign = 'left';
                            ctx.fillText(u.movies, 250, u.y+4);
                        });
                        ctx.textAlign = 'center';
                    }
                    
                    if (currentStep >= 2) {
                        // STEP 2: Find similarity
                        ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 3; ctx.setLineDash([5,5]);
                        ctx.beginPath(); ctx.moveTo(115, 90); ctx.lineTo(200, 90); ctx.stroke();
                        ctx.setLineDash([]);
                        
                        ctx.fillStyle = '#f59e0b'; ctx.font = 'bold 12px Inter';
                        ctx.fillText('You both loved Matrix!', 160, 70);
                        ctx.fillText('SIMILAR TASTE = 92%', 160, 260);
                    }
                    
                    if (currentStep >= 3) {
                        // STEP 3: Make recommendation
                        ctx.fillStyle = '#ec4899';
                        ctx.fillRect(350, 100, 150, 100);
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('üéØ FOR YOU:', 425, 125);
                        ctx.font = '12px Inter';
                        ctx.fillText('Since Tom loved Inception', 425, 150);
                        ctx.fillText('and you\'re similar...', 425, 168);
                        ctx.fillStyle = '#10b981'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('‚Üí Watch Inception! ‚≠ê', 425, 190);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter'; ctx.textAlign = 'center';
                    const stepLabels = [
                        'Step 1: You want a recommendation...',
                        'Step 2: Find users with similar ratings',
                        'Step 3: Calculate similarity scores',
                        'Step 4: Recommend what THEY loved!'
                    ];
                    ctx.fillText(stepLabels[currentStep], W/2, H - 15);
                },
                
                matrix_factorization: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const matW = 120, matH = 80;
                    const pulse = Math.sin(frame * 0.05) * 0.2 + 0.8;
                    
                    // Step 0: Show R matrix
                    ctx.fillStyle = '#2563eb'; ctx.fillRect(50, H/2 - matH/2, matW, matH);
                    ctx.fillStyle = '#fff'; ctx.font = 'bold 20px Inter'; ctx.textAlign = 'center';
                    ctx.fillText('R', 50 + matW/2, H/2 + 7);
                    ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter';
                    ctx.fillText('Ratings', 50 + matW/2, H/2 + matH/2 + 20);
                    
                    if (currentStep >= 1) {
                        // Step 1: Show decomposition arrow
                        ctx.fillStyle = '#f59e0b'; ctx.font = '30px Inter';
                        ctx.fillText('‚âà', 200, H/2 + 10);
                    }
                    
                    if (currentStep >= 2) {
                        // Step 2: Show U matrix
                        ctx.fillStyle = `rgba(16, 185, 129, ${pulse})`; 
                        ctx.fillRect(250, H/2 - 60, 80, 100);
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 18px Inter';
                        ctx.fillText('U', 290, H/2);
                        ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter';
                        ctx.fillText('User factors', 290, H/2 + 70);
                        
                        ctx.fillStyle = '#fff'; ctx.font = '24px Inter';
                        ctx.fillText('√ó', 355, H/2 + 5);
                    }
                    
                    if (currentStep >= 3) {
                        // Step 3: Show V^T matrix
                        ctx.fillStyle = `rgba(236, 72, 153, ${pulse})`;
                        ctx.fillRect(390, H/2 - 40, 120, 60);
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 18px Inter';
                        ctx.fillText('V·µÄ', 450, H/2 + 5);
                        ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter';
                        ctx.fillText('Item factors', 450, H/2 + 50);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: Rating Matrix R', 'Step 2: Decompose R ‚âà U√óV·µÄ', 'Step 3: Learn User Factors', 'Step 4: Learn Item Factors'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                content_based: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    // Step 0: Show item with features
                    ctx.fillStyle = '#27ae60'; ctx.font = '40px Inter'; ctx.textAlign = 'center';
                    ctx.fillText('üìö', 100, 100);
                    ctx.fillStyle = '#fff'; ctx.font = '14px Inter';
                    ctx.fillText('Book A', 100, 130);
                    
                    if (currentStep >= 1) {
                        // Extract features
                        const features = ['Fantasy', 'Dragons', 'Magic'];
                        features.forEach((f, i) => {
                            ctx.fillStyle = '#3b82f6';
                            ctx.fillRect(200, 60 + i*40, 100, 30);
                            ctx.fillStyle = '#fff'; ctx.font = '12px Inter';
                            ctx.fillText(f, 250, 80 + i*40);
                        });
                        ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 2;
                        ctx.beginPath(); ctx.moveTo(130, 90); ctx.lineTo(200, 90); ctx.stroke();
                    }
                    
                    if (currentStep >= 2) {
                        // User profile
                        ctx.fillStyle = '#9b59b6';
                        ctx.fillRect(350, 70, 120, 80);
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('User Profile', 410, 95);
                        ctx.font = '11px Inter';
                        ctx.fillText('Likes: Fantasy 0.9', 410, 115);
                        ctx.fillText('Dragons 0.8', 410, 130);
                    }
                    
                    if (currentStep >= 3) {
                        // Match new item
                        ctx.fillStyle = '#ec4899'; ctx.font = '40px Inter';
                        ctx.fillText('üìö', 410, 220);
                        ctx.fillStyle = '#fff'; ctx.font = '14px Inter';
                        ctx.fillText('Book B (sim=0.95)', 410, 250);
                        ctx.fillText('‚úì RECOMMEND', 410, 275);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: Analyze Item', 'Step 2: Extract Features', 'Step 3: Build User Profile', 'Step 4: Match Similar Items'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                graph_based: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const nodes = [
                        {x: 100, y: H/2, type: 'user', label: 'You'},
                        {x: 250, y: 100, type: 'item', label: 'A'},
                        {x: 250, y: H/2, type: 'item', label: 'B'},
                        {x: 250, y: H-100, type: 'item', label: 'C'},
                        {x: 400, y: 150, type: 'user', label: 'U2'},
                        {x: 400, y: H-150, type: 'user', label: 'U3'},
                        {x: W-100, y: H/2, type: 'item', label: '?'}
                    ];
                    
                    // Draw edges based on step
                    ctx.strokeStyle = 'rgba(59, 130, 246, 0.5)'; ctx.lineWidth = 2;
                    if (currentStep >= 1) {
                        [[0,1], [0,2]].forEach(([a,b]) => {
                            ctx.beginPath(); ctx.moveTo(nodes[a].x, nodes[a].y);
                            ctx.lineTo(nodes[b].x, nodes[b].y); ctx.stroke();
                        });
                    }
                    if (currentStep >= 2) {
                        [[1,4], [2,4], [2,5], [3,5]].forEach(([a,b]) => {
                            ctx.beginPath(); ctx.moveTo(nodes[a].x, nodes[a].y);
                            ctx.lineTo(nodes[b].x, nodes[b].y); ctx.stroke();
                        });
                    }
                    if (currentStep >= 3) {
                        ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 3;
                        ctx.beginPath(); ctx.moveTo(nodes[4].x, nodes[4].y);
                        ctx.lineTo(nodes[6].x, nodes[6].y); ctx.stroke();
                    }
                    
                    // Draw nodes
                    nodes.forEach((n, i) => {
                        if (i === 6 && currentStep < 3) return;
                        ctx.beginPath(); ctx.arc(n.x, n.y, 25, 0, Math.PI*2);
                        ctx.fillStyle = n.type === 'user' ? '#2563eb' : '#10b981'; ctx.fill();
                        ctx.fillStyle = '#fff'; ctx.font = '12px Inter'; ctx.textAlign = 'center';
                        ctx.fillText(n.label, n.x, n.y + 4);
                    });
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: Build Graph', 'Step 2: Your Connections', 'Step 3: Propagate Scores', 'Step 4: Discover New Items'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                neural_cf: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const layers = [
                        {x: 80, nodes: 2, label: 'Input'},
                        {x: 200, nodes: 4, label: 'Embed'},
                        {x: 320, nodes: 6, label: 'Hidden'},
                        {x: 440, nodes: 3, label: 'Output'},
                        {x: 540, nodes: 1, label: 'Score'}
                    ];
                    
                    // Draw layers based on step
                    const visibleLayers = Math.min(currentStep + 2, layers.length);
                    
                    for (let l = 0; l < visibleLayers; l++) {
                        const layer = layers[l];
                        const startY = H/2 - (layer.nodes - 1) * 25;
                        
                        for (let n = 0; n < layer.nodes; n++) {
                            const y = startY + n * 50;
                            
                            // Draw connections to next layer
                            if (l < visibleLayers - 1 && l < layers.length - 1) {
                                const next = layers[l + 1];
                                const nextStartY = H/2 - (next.nodes - 1) * 25;
                                ctx.strokeStyle = 'rgba(139, 92, 246, 0.3)'; ctx.lineWidth = 1;
                                for (let nn = 0; nn < next.nodes; nn++) {
                                    ctx.beginPath();
                                    ctx.moveTo(layer.x + 15, y);
                                    ctx.lineTo(next.x - 15, nextStartY + nn * 50);
                                    ctx.stroke();
                                }
                            }
                            
                            // Draw node
                            ctx.beginPath(); ctx.arc(layer.x, y, 15, 0, Math.PI*2);
                            ctx.fillStyle = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981'][l];
                            ctx.fill();
                        }
                        
                        ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter'; ctx.textAlign = 'center';
                        ctx.fillText(layer.label, layer.x, H - 40);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: User & Item IDs', 'Step 2: Embedding Layer', 'Step 3: Hidden Layers', 'Step 4: Prediction'];
                    ctx.fillText(labels[currentStep], W/2, H - 15);
                },
                
                hybrid: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const methods = [
                        {y: 80, label: 'CF', color: '#3b82f6', score: 0.85},
                        {y: 160, label: 'Content', color: '#10b981', score: 0.72},
                        {y: 240, label: 'Pop', color: '#f59e0b', score: 0.65}
                    ];
                    
                    methods.forEach((m, i) => {
                        if (currentStep >= i) {
                            ctx.fillStyle = m.color;
                            ctx.fillRect(50, m.y - 20, 100, 40);
                            ctx.fillStyle = '#fff'; ctx.font = 'bold 14px Inter'; ctx.textAlign = 'center';
                            ctx.fillText(m.label, 100, m.y + 5);
                            
                            if (currentStep >= 2) {
                                ctx.fillStyle = '#94a3b8'; ctx.font = '12px Inter';
                                ctx.fillText(`‚Üí ${m.score}`, 200, m.y + 5);
                            }
                        }
                    });
                    
                    if (currentStep >= 3) {
                        // Combination
                        ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 2;
                        methods.forEach(m => {
                            ctx.beginPath(); ctx.moveTo(230, m.y); ctx.lineTo(350, H/2); ctx.stroke();
                        });
                        
                        ctx.fillStyle = '#ec4899';
                        ctx.beginPath(); ctx.arc(380, H/2, 40, 0, Math.PI*2); ctx.fill();
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 16px Inter';
                        ctx.fillText('0.79', 380, H/2 + 5);
                        ctx.fillStyle = '#94a3b8'; ctx.font = '12px Inter';
                        ctx.fillText('Combined', 380, H/2 + 60);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: Run CF', 'Step 2: Run Content-Based', 'Step 3: Get Scores', 'Step 4: Combine Results'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                association_rules: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const baskets = ['üçºüç∫', 'üçûü•õüç∫', 'üçºüç∫ü•õ'];
                    
                    // Draw baskets
                    baskets.forEach((b, i) => {
                        if (currentStep >= 0) {
                            ctx.fillStyle = '#1e293b';
                            ctx.fillRect(50 + i*150, 60, 120, 60);
                            ctx.fillStyle = '#fff'; ctx.font = '24px Inter'; ctx.textAlign = 'center';
                            ctx.fillText(b, 110 + i*150, 100);
                        }
                    });
                    
                    if (currentStep >= 1) {
                        ctx.fillStyle = '#f59e0b'; ctx.font = '14px Inter';
                        ctx.fillText('Support(üçº,üç∫) = 2/3 = 0.67', W/2, 160);
                    }
                    
                    if (currentStep >= 2) {
                        ctx.fillStyle = '#10b981'; ctx.font = '14px Inter';
                        ctx.fillText('Confidence(üçº‚Üíüç∫) = 2/2 = 1.0', W/2, 200);
                    }
                    
                    if (currentStep >= 3) {
                        ctx.fillStyle = '#ec4899'; ctx.font = 'bold 16px Inter';
                        ctx.fillText('RULE: üçº ‚Üí üç∫ (Lift=1.5)', W/2, 260);
                        ctx.font = '12px Inter'; ctx.fillStyle = '#94a3b8';
                        ctx.fillText('Buy diapers? Recommend beer!', W/2, 290);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const labels = ['Step 1: Scan Transactions', 'Step 2: Calculate Support', 'Step 3: Calculate Confidence', 'Step 4: Generate Rules'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                popularity_baseline: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    const items = [
                        {label: 'üé¨ Movie A', count: 1500},
                        {label: 'üé¨ Movie B', count: 1200},
                        {label: 'üé¨ Movie C', count: 800},
                        {label: 'üé¨ Movie D', count: 400}
                    ];
                    
                    const maxCount = 1500;
                    const barWidth = W - 200;
                    
                    items.forEach((item, i) => {
                        if (currentStep >= Math.floor(i / 2)) {
                            const y = 80 + i * 60;
                            const width = (item.count / maxCount) * barWidth * (currentStep >= 2 ? 1 : 0.5);
                            
                            ctx.fillStyle = i === 0 && currentStep >= 3 ? '#10b981' : '#3b82f6';
                            ctx.fillRect(150, y, width, 35);
                            
                            ctx.fillStyle = '#fff'; ctx.font = '13px Inter'; ctx.textAlign = 'left';
                            ctx.fillText(item.label, 50, y + 22);
                            
                            if (currentStep >= 2) {
                                ctx.fillStyle = '#94a3b8'; ctx.textAlign = 'right';
                                ctx.fillText(item.count + ' views', 150 + width - 10, y + 22);
                            }
                        }
                    });
                    
                    if (currentStep >= 3) {
                        ctx.fillStyle = '#10b981'; ctx.font = 'bold 14px Inter'; ctx.textAlign = 'center';
                        ctx.fillText('‚Üí Recommend: Movie A (Most Popular)', W/2, H - 50);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter'; ctx.textAlign = 'center';
                    const labels = ['Step 1: Collect Interactions', 'Step 2: Count Popularity', 'Step 3: Rank Items', 'Step 4: Recommend Top'];
                    ctx.fillText(labels[currentStep], W/2, H - 20);
                },
                
                svdpp: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    // Step 0: Show user with explicit ratings
                    ctx.fillStyle = '#8e44ad'; ctx.font = 'bold 16px Inter'; ctx.textAlign = 'center';
                    ctx.fillText('üë§ User Tom', 100, 50);
                    
                    // Explicit ratings
                    const explicit = [{item: 'üé¨ Action', rating: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'}, {item: 'üé≠ Drama', rating: '‚≠ê‚≠ê‚≠ê'}];
                    explicit.forEach((e, i) => {
                        ctx.fillStyle = '#3b82f6';
                        ctx.fillRect(50, 80 + i*50, 150, 40);
                        ctx.fillStyle = '#fff'; ctx.font = '12px Inter';
                        ctx.fillText(e.item + ' ' + e.rating, 125, 105 + i*50);
                    });
                    ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter';
                    ctx.fillText('Explicit Ratings', 125, 200);
                    
                    if (currentStep >= 1) {
                        // Step 1: Show implicit behavior
                        ctx.fillStyle = '#f59e0b'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('+ Implicit Behavior', 350, 50);
                        
                        const implicit = ['üëÅÔ∏è Viewed Sci-Fi', 'üëÅÔ∏è Browsed Horror', 'üëÅÔ∏è Clicked Thriller'];
                        implicit.forEach((item, i) => {
                            ctx.fillStyle = 'rgba(245, 158, 11, 0.3)';
                            ctx.fillRect(280, 80 + i*40, 140, 30);
                            ctx.fillStyle = '#f59e0b'; ctx.font = '11px Inter';
                            ctx.fillText(item, 350, 100 + i*40);
                        });
                    }
                    
                    if (currentStep >= 2) {
                        // Step 2: Combine signals
                        ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 2;
                        ctx.beginPath(); ctx.moveTo(200, 120); ctx.lineTo(250, 200); ctx.stroke();
                        ctx.beginPath(); ctx.moveTo(350, 160); ctx.lineTo(300, 200); ctx.stroke();
                        
                        ctx.fillStyle = '#ec4899';
                        ctx.beginPath(); ctx.arc(275, 230, 30, 0, Math.PI*2); ctx.fill();
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 12px Inter';
                        ctx.fillText('SVD++', 275, 235);
                    }
                    
                    if (currentStep >= 3) {
                        // Step 3: Better prediction
                        ctx.fillStyle = '#10b981'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('üéØ Predict: Sci-Fi = 4.2‚≠ê', 275, 300);
                        ctx.fillStyle = '#94a3b8'; ctx.font = '11px Inter';
                        ctx.fillText('(Regular SVD would miss this!)', 275, 320);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const stepLabels = ['Step 1: Explicit Ratings', 'Step 2: Add Implicit Signals', 'Step 3: Combine Both', 'Step 4: Better Predictions'];
                    ctx.fillText(stepLabels[currentStep], W/2, H - 20);
                },
                
                context_aware: () => {
                    ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, W, H);
                    
                    // Step 0: Show user and item
                    ctx.fillStyle = '#16a085'; ctx.font = 'bold 16px Inter'; ctx.textAlign = 'center';
                    ctx.fillText('üë§ Lisa ‚ù§Ô∏è Pizza', W/2, 40);
                    
                    // Traditional approach
                    ctx.fillStyle = '#3b82f6';
                    ctx.fillRect(50, 70, 180, 50);
                    ctx.fillStyle = '#fff'; ctx.font = '12px Inter';
                    ctx.fillText('Traditional: Always Pizza üçï', 140, 100);
                    
                    if (currentStep >= 1) {
                        // Step 1: Show contexts
                        ctx.fillStyle = '#f59e0b'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('üåç But CONTEXT matters!', W/2, 160);
                        
                        const contexts = [
                            {ctx: 'üåô Friday Night + Friends', rec: 'üçï Pizza!'},
                            {ctx: '‚òÄÔ∏è Monday Lunch + Office', rec: 'ü•ó Salad'},
                            {ctx: 'üë®‚Äçüë©‚Äçüëß Sunday + Family', rec: 'üçù Pasta'}
                        ];
                        
                        contexts.forEach((c, i) => {
                            if (currentStep >= i + 1) {
                                ctx.fillStyle = 'rgba(22, 160, 133, 0.2)';
                                ctx.fillRect(50, 180 + i*45, W-100, 35);
                                ctx.fillStyle = '#16a085'; ctx.font = '11px Inter';
                                ctx.fillText(c.ctx + ' ‚Üí ' + c.rec, W/2, 202 + i*45);
                            }
                        });
                    }
                    
                    if (currentStep >= 3) {
                        ctx.fillStyle = '#ec4899'; ctx.font = 'bold 14px Inter';
                        ctx.fillText('Same user, DIFFERENT recommendations!', W/2, 330);
                    }
                    
                    ctx.fillStyle = '#94a3b8'; ctx.font = 'bold 13px Inter';
                    const stepLabels = ['Step 1: User Preference', 'Step 2: Add Time Context', 'Step 3: Add Social Context', 'Step 4: Context-Aware Recs'];
                    ctx.fillText(stepLabels[currentStep], W/2, H - 20);
                }
            };
            
            function animate() {
                const animFn = animations[key] || animations.collaborative_filtering;
                animFn();
                
                frame++;
                if (!animPaused && document.getElementById('algo-modal').classList.contains('active')) {
                    // Auto-advance steps every 90 frames (~1.5s)
                    if (frame % 90 === 0 && currentStep < maxSteps - 1) {
                        currentStep++;
                        updateStepUI();
                    }
                }
                
                if (document.getElementById('algo-modal').classList.contains('active')) {
                    animFrame = requestAnimationFrame(animate);
                }
            }
            animate();
        }
        
        // Charts
        function initOverviewCharts() {
            const data = resultsData.datasets['MovieLens-100K'];
            Plotly.newPlot('overview-chart', [{
                x: resultsData.algorithms,
                y: data.rmse,
                error_y: { type: 'data', array: data.rmse_std, visible: true },
                type: 'bar',
                marker: { color: data.rmse.map(v => v === Math.min(...data.rmse) ? '#10b981' : '#2563eb') }
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE (lower is better)', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
        }
        
        function initComparisonCharts() {
            const data = resultsData.datasets['MovieLens-100K'];
            const algos = resultsData.algorithms;
            
            // RMSE with CI
            Plotly.newPlot('rmse-ci-chart', [{
                x: algos,
                y: data.rmse,
                error_y: { type: 'data', array: data.rmse_std.map(s => s * 1.96), visible: true },
                type: 'bar',
                marker: { color: '#2563eb' },
                name: 'RMSE'
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)', range: [0.8, 1.1] },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
            
            // NDCG
            Plotly.newPlot('ndcg-chart', [{
                x: algos,
                y: data.ndcg10,
                type: 'bar',
                marker: { color: '#10b981' }
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'NDCG@10', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
            
            // Radar
            const radarData = ['MF-SVD', 'User-CF', 'Content', 'NCF', 'Pop'].map((name, i) => {
                const idx = algos.indexOf(name);
                return {
                    type: 'scatterpolar',
                    r: [1-data.rmse[idx], 1-data.mae[idx], data.ndcg10[idx]*3, data.coverage[idx]/100, 1-data.train_time[idx]/20],
                    theta: ['Accuracy', 'MAE‚Åª¬π', 'NDCG', 'Coverage', 'Speed'],
                    fill: 'toself',
                    name: name,
                    line: { color: ['#2563eb', '#3b82f6', '#10b981', '#ef4444', '#6b7280'][i] }
                };
            });
            
            Plotly.newPlot('radar-chart', radarData, {
                polar: {
                    bgcolor: 'transparent',
                    radialaxis: { visible: true, range: [0, 1], gridcolor: 'rgba(255,255,255,0.2)' },
                    angularaxis: { gridcolor: 'rgba(255,255,255,0.2)' }
                },
                paper_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                legend: { x: 0, y: 1 }
            }, { responsive: true });
            
            // Trade-off
            Plotly.newPlot('tradeoff-chart', [{
                x: data.train_time,
                y: data.rmse,
                mode: 'markers+text',
                text: algos,
                textposition: 'top center',
                marker: { size: 15, color: data.rmse, colorscale: 'RdYlGn_r', showscale: true }
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { title: 'Training Time (s)', gridcolor: 'rgba(255,255,255,0.1)', type: 'log' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 60 }
            }, { responsive: true });
            
            // CD Diagram
            const ranks = algos.map((_, i) => i + 1 + Math.random() * 2);
            Plotly.newPlot('cd-diagram-chart', [{
                x: ranks,
                y: algos,
                type: 'bar',
                orientation: 'h',
                marker: { color: '#2563eb' }
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { title: 'Average Rank', gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { autorange: 'reversed' },
                margin: { l: 100, t: 10, b: 40 }
            }, { responsive: true });
            
            // Pairwise heatmap
            const n = algos.length;
            const pvals = Array.from({length: n}, (_, i) => 
                Array.from({length: n}, (_, j) => i === j ? 1 : Math.random() * 0.1)
            );
            
            Plotly.newPlot('pairwise-heatmap', [{
                z: pvals,
                x: algos,
                y: algos,
                type: 'heatmap',
                colorscale: [[0, '#10b981'], [0.05, '#fbbf24'], [1, '#ef4444']],
                zmin: 0,
                zmax: 0.1
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                margin: { l: 100, b: 100 }
            }, { responsive: true });
            
            // Effect sizes
            const effectSizes = algos.map(a => ({
                name: a,
                d: (Math.random() * 2 - 0.5).toFixed(2),
                interp: ['negligible', 'small', 'medium', 'large'][Math.floor(Math.random() * 4)]
            }));
            
            document.getElementById('effect-sizes').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;">
                    ${effectSizes.map(e => `
                        <div style="background: var(--darker); padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: 600;">${e.name}</div>
                            <div style="font-size: 1.25rem; color: var(--primary);">d = ${e.d}</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${e.interp}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function initResultsCharts() {
            const datasets = Object.keys(resultsData.datasets);
            const algos = resultsData.algorithms;
            
            // Multi-dataset chart
            const traces = datasets.map((ds, i) => ({
                name: ds,
                x: algos,
                y: resultsData.datasets[ds].rmse,
                type: 'bar',
                marker: { color: ['#3b82f6', '#f59e0b', '#8b5cf6'][i] }
            }));
            
            Plotly.newPlot('multi-dataset-chart', traces, {
                barmode: 'group',
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                legend: { x: 1, xanchor: 'right', y: 1 },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
            
            // Ablation
            Plotly.newPlot('ablation-chart', [{
                x: ['Full Model', 'w/o CF', 'w/o Content', 'w/o Popularity', 'Base Only'],
                y: [0.88, 0.92, 0.91, 0.93, 0.98],
                type: 'bar',
                marker: { color: ['#10b981', '#ef4444', '#ef4444', '#ef4444', '#6b7280'] }
            }], {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)', range: [0.85, 1.0] },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
        }
        
        function initHPCharts() {
            // Initialize with MovieLens data
            updateSensitivityCharts('movielens');
            updateInteractionCharts('movielens');
            
            // Initialize other HP charts
            initStaticHPCharts();
            
            // Initialize HP table and playground
            switchHPTable('movielens');
            initPlayground();
            initPlaygroundChart();
        }
        
        // ============= SENSITIVITY DATA BY DATASET =============
        const sensitivityData = {
            'movielens': {
                name: 'MovieLens-100K',
                factors: {
                    x: [10, 20, 50, 100, 200],
                    traces: [
                        { y: [0.95, 0.91, 0.8956, 0.89, 0.895], name: 'SVD', color: '#3b82f6' },
                        { y: [0.97, 0.93, 0.9123, 0.90, 0.905], name: 'ALS', color: '#10b981' },
                        { y: [0.96, 0.92, 0.9045, 0.895, 0.90], name: 'Funk SVD', color: '#f59e0b' }
                    ]
                },
                reg: {
                    x: [0.001, 0.01, 0.02, 0.05, 0.1, 0.2],
                    traces: [
                        { y: [0.92, 0.90, 0.8956, 0.91, 0.95, 1.02], name: 'k=50', color: '#3b82f6' },
                        { y: [0.94, 0.91, 0.90, 0.92, 0.97, 1.05], name: 'k=20', color: '#10b981' },
                        { y: [0.91, 0.89, 0.89, 0.90, 0.94, 1.00], name: 'k=100', color: '#f59e0b' }
                    ]
                },
                knn: {
                    x: [5, 10, 20, 30, 50, 100],
                    traces: [
                        { y: [0.98, 0.96, 0.9456, 0.95, 0.96, 0.97], name: 'User-CF Cosine', color: '#3b82f6' },
                        { y: [1.00, 0.98, 0.96, 0.97, 0.98, 0.99], name: 'User-CF Pearson', color: '#3b82f6', dash: 'dash' },
                        { y: [0.99, 0.97, 0.9678, 0.97, 0.98, 0.98], name: 'Item-CF Cosine', color: '#10b981' },
                        { y: [1.01, 0.99, 0.98, 0.99, 1.00, 1.01], name: 'Item-CF Pearson', color: '#10b981', dash: 'dash' }
                    ]
                },
                damping: {
                    x: [0.5, 0.7, 0.8, 0.85, 0.9, 0.95],
                    traces: [
                        { y: [0.99, 0.97, 0.96, 0.9547, 0.96, 0.97], name: 'PageRank', color: '#e67e22' },
                        { y: [1.01, 0.98, 0.97, 0.9623, 0.97, 0.98], name: 'Random Walk', color: '#8b5cf6' },
                        { y: [1.02, 0.99, 0.98, 0.9712, 0.98, 0.99], name: 'Personalized PR', color: '#ef4444' }
                    ]
                },
                heatmap: [
                    [0.95, 0.93, 0.94, 0.97],
                    [0.92, 0.90, 0.91, 0.95],
                    [0.90, 0.8956, 0.90, 0.94],
                    [0.91, 0.90, 0.92, 0.96]
                ]
            },
            'amazon': {
                name: 'Amazon-Style',
                factors: {
                    x: [10, 20, 50, 100, 200],
                    traces: [
                        { y: [1.12, 1.08, 1.0234, 1.01, 1.015], name: 'SVD', color: '#3b82f6' },
                        { y: [1.15, 1.10, 1.0456, 1.03, 1.035], name: 'ALS', color: '#10b981' },
                        { y: [1.13, 1.09, 1.0345, 1.02, 1.025], name: 'Funk SVD', color: '#f59e0b' }
                    ]
                },
                reg: {
                    x: [0.001, 0.01, 0.02, 0.05, 0.1, 0.2],
                    traces: [
                        { y: [1.08, 1.04, 1.0234, 1.05, 1.10, 1.18], name: 'k=50', color: '#3b82f6' },
                        { y: [1.10, 1.06, 1.04, 1.07, 1.12, 1.20], name: 'k=20', color: '#10b981' },
                        { y: [1.06, 1.02, 1.01, 1.03, 1.08, 1.15], name: 'k=100', color: '#f59e0b' }
                    ]
                },
                knn: {
                    x: [5, 10, 20, 30, 50, 100],
                    traces: [
                        { y: [1.18, 1.15, 1.1234, 1.13, 1.14, 1.15], name: 'User-CF Cosine', color: '#3b82f6' },
                        { y: [1.22, 1.19, 1.16, 1.17, 1.18, 1.19], name: 'User-CF Pearson', color: '#3b82f6', dash: 'dash' },
                        { y: [1.16, 1.13, 1.1123, 1.12, 1.13, 1.14], name: 'Item-CF Cosine', color: '#10b981' },
                        { y: [1.20, 1.17, 1.14, 1.15, 1.16, 1.17], name: 'Item-CF Pearson', color: '#10b981', dash: 'dash' }
                    ]
                },
                damping: {
                    x: [0.5, 0.7, 0.8, 0.85, 0.9, 0.95],
                    traces: [
                        { y: [1.10, 1.06, 1.03, 1.0123, 1.02, 1.04], name: 'PageRank', color: '#e67e22' },
                        { y: [1.12, 1.08, 1.05, 1.0234, 1.04, 1.06], name: 'Random Walk', color: '#8b5cf6' },
                        { y: [1.14, 1.10, 1.07, 1.0456, 1.06, 1.08], name: 'Personalized PR', color: '#ef4444' }
                    ]
                },
                heatmap: [
                    [1.10, 1.08, 1.09, 1.12],
                    [1.07, 1.05, 1.06, 1.10],
                    [1.05, 1.0234, 1.04, 1.08],
                    [1.06, 1.04, 1.06, 1.10]
                ]
            },
            'bookcrossing': {
                name: 'BookCrossing-Style',
                factors: {
                    x: [10, 20, 50, 100, 200],
                    traces: [
                        { y: [1.22, 1.18, 1.1456, 1.13, 1.135], name: 'SVD', color: '#3b82f6' },
                        { y: [1.25, 1.20, 1.1678, 1.15, 1.155], name: 'ALS', color: '#10b981' },
                        { y: [1.23, 1.19, 1.1567, 1.14, 1.145], name: 'Funk SVD', color: '#f59e0b' }
                    ]
                },
                reg: {
                    x: [0.001, 0.01, 0.02, 0.05, 0.1, 0.2],
                    traces: [
                        { y: [1.18, 1.15, 1.1456, 1.16, 1.22, 1.32], name: 'k=50', color: '#3b82f6' },
                        { y: [1.20, 1.17, 1.16, 1.18, 1.24, 1.35], name: 'k=20', color: '#10b981' },
                        { y: [1.16, 1.13, 1.13, 1.14, 1.20, 1.28], name: 'k=100', color: '#f59e0b' }
                    ]
                },
                knn: {
                    x: [5, 10, 20, 30, 50, 100],
                    traces: [
                        { y: [1.28, 1.25, 1.2145, 1.22, 1.23, 1.24], name: 'User-CF Cosine', color: '#3b82f6' },
                        { y: [1.35, 1.32, 1.28, 1.29, 1.30, 1.31], name: 'User-CF Pearson', color: '#3b82f6', dash: 'dash' },
                        { y: [1.26, 1.23, 1.2034, 1.21, 1.22, 1.23], name: 'Item-CF Cosine', color: '#10b981' },
                        { y: [1.32, 1.29, 1.25, 1.26, 1.27, 1.28], name: 'Item-CF Pearson', color: '#10b981', dash: 'dash' }
                    ]
                },
                damping: {
                    x: [0.5, 0.7, 0.8, 0.85, 0.9, 0.95],
                    traces: [
                        { y: [1.16, 1.12, 1.10, 1.0987, 1.10, 1.12], name: 'PageRank', color: '#e67e22' },
                        { y: [1.18, 1.14, 1.12, 1.1098, 1.12, 1.14], name: 'Random Walk', color: '#8b5cf6' },
                        { y: [1.20, 1.16, 1.14, 1.1234, 1.14, 1.16], name: 'Personalized PR', color: '#ef4444' }
                    ]
                },
                heatmap: [
                    [1.20, 1.18, 1.19, 1.22],
                    [1.17, 1.15, 1.16, 1.20],
                    [1.15, 1.1456, 1.15, 1.18],
                    [1.16, 1.14, 1.16, 1.20]
                ]
            }
        };
        
        // ============= DYNAMIC SENSITIVITY CHART UPDATE =============
        function updateSensitivityCharts(dataset) {
            // Update button states
            ['movielens', 'amazon', 'bookcrossing'].forEach(d => {
                const btn = document.getElementById('sens-btn-' + d);
                if (btn) btn.classList.toggle('active', d === dataset);
            });
            
            const data = sensitivityData[dataset];
            if (!data) return;
            
            const plotConfig = { responsive: true };
            const baseLayout = {
                paper_bgcolor: 'transparent', 
                plot_bgcolor: 'transparent', 
                font: { color: '#94a3b8' },
                legend: { x: 1, xanchor: 'right', y: 1 }, 
                margin: { t: 20, b: 50 }
            };
            
            // Update titles
            document.getElementById('title-factors').textContent = 'Latent Factors (k) vs RMSE - ' + data.name;
            document.getElementById('title-reg').textContent = 'Regularization (Œª) vs RMSE - ' + data.name;
            document.getElementById('title-knn').textContent = 'k_neighbors vs RMSE (CF Methods) - ' + data.name;
            document.getElementById('title-damping').textContent = 'Damping Factor (Œ±) vs RMSE (Graph Methods) - ' + data.name;
            
            // 1. Latent Factors chart
            Plotly.react('sensitivity-factors-chart', 
                data.factors.traces.map(t => ({
                    x: data.factors.x, y: t.y, name: t.name,
                    mode: 'lines+markers', marker: { size: 8 },
                    line: { color: t.color, dash: t.dash || 'solid' }
                })), 
                { ...baseLayout, xaxis: { title: 'n_factors (k)', gridcolor: 'rgba(255,255,255,0.1)' },
                  yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' } }, 
                plotConfig
            );
            
            // 2. Regularization chart
            Plotly.react('sensitivity-reg-chart', 
                data.reg.traces.map(t => ({
                    x: data.reg.x, y: t.y, name: t.name,
                    mode: 'lines+markers', marker: { size: 8 },
                    line: { color: t.color, dash: t.dash || 'solid' }
                })), 
                { ...baseLayout, xaxis: { title: 'regularization (Œª)', type: 'log', gridcolor: 'rgba(255,255,255,0.1)' },
                  yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' } }, 
                plotConfig
            );
            
            // 3. k_neighbors chart
            Plotly.react('sensitivity-knn-chart', 
                data.knn.traces.map(t => ({
                    x: data.knn.x, y: t.y, name: t.name,
                    mode: 'lines+markers', marker: { size: 6 },
                    line: { color: t.color, dash: t.dash || 'solid' }
                })), 
                { ...baseLayout, xaxis: { title: 'k_neighbors', gridcolor: 'rgba(255,255,255,0.1)' },
                  yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' } }, 
                plotConfig
            );
            
            // 4. Damping factor chart
            Plotly.react('sensitivity-damping-chart', 
                data.damping.traces.map(t => ({
                    x: data.damping.x, y: t.y, name: t.name,
                    mode: 'lines+markers', marker: { size: 8 },
                    line: { color: t.color, dash: t.dash || 'solid' }
                })), 
                { ...baseLayout, xaxis: { title: 'Damping Factor (Œ±)', gridcolor: 'rgba(255,255,255,0.1)' },
                  yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' } }, 
                plotConfig
            );
        }
        
        // ============= DYNAMIC INTERACTION CHART UPDATE =============
        function updateInteractionCharts(dataset) {
            // Update button states
            ['movielens', 'amazon', 'bookcrossing'].forEach(d => {
                const btn = document.getElementById('int-btn-' + d);
                if (btn) btn.classList.toggle('active', d === dataset);
            });
            
            const data = sensitivityData[dataset];
            if (!data) return;
            
            // Update title
            document.getElementById('title-heatmap').textContent = 'üìä n_factors √ó regularization Interaction Heatmap - ' + data.name;
            
            const factors = [10, 20, 50, 100];
            const regs = [0.01, 0.02, 0.05, 0.1];
            
            // Calculate color scale range based on dataset
            const flatData = data.heatmap.flat();
            const minVal = Math.min(...flatData);
            const maxVal = Math.max(...flatData);
            
            Plotly.react('interaction-heatmap', [{
                z: data.heatmap, 
                x: regs.map(r => 'Œª=' + r), 
                y: factors.map(f => 'k=' + f),
                type: 'heatmap', 
                colorscale: [[0, '#10b981'], [0.5, '#fbbf24'], [1, '#ef4444']],
                showscale: true, 
                colorbar: { title: 'RMSE' },
                zmin: minVal - 0.02,
                zmax: maxVal + 0.02
            }], {
                paper_bgcolor: 'transparent', 
                plot_bgcolor: 'transparent', 
                font: { color: '#94a3b8' },
                margin: { t: 20, b: 60, l: 60 },
                annotations: data.heatmap.flatMap((row, i) => row.map((val, j) => ({
                    x: regs.map(r => 'Œª=' + r)[j], 
                    y: factors.map(f => 'k=' + f)[i],
                    text: val.toFixed(3), 
                    showarrow: false, 
                    font: { color: val < (minVal + maxVal) / 2 ? 'white' : 'black' }
                })))
            }, { responsive: true });
        }
        
        // ============= STATIC HP CHARTS (non-dataset-dependent) =============
        function initStaticHPCharts() {
            // Heatmap is now handled by updateInteractionCharts()
            
            // 6. CF Interaction chart
            Plotly.newPlot('interaction-cf-chart', [
                { x: [5, 10, 20, 30, 50], y: [0.98, 0.96, 0.9456, 0.95, 0.96], name: 'Cosine', type: 'bar', marker: { color: '#3b82f6' } },
                { x: [5, 10, 20, 30, 50], y: [1.00, 0.98, 0.96, 0.97, 0.98], name: 'Pearson', type: 'bar', marker: { color: '#8b5cf6' } }
            ], {
                barmode: 'group',
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                xaxis: { title: 'k_neighbors', gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                legend: { x: 1, xanchor: 'right', y: 1 }, margin: { t: 20, b: 50 }
            }, { responsive: true });
            
            // 7. NCF Interaction chart
            Plotly.newPlot('interaction-ncf-chart', [
                { x: ['[64,32]', '[128,64]', '[128,64,32]', '[256,128,64]'], y: [0.92, 0.91, 0.9012, 0.905], name: 'dim=32', type: 'bar', marker: { color: '#ef4444' } },
                { x: ['[64,32]', '[128,64]', '[128,64,32]', '[256,128,64]'], y: [0.91, 0.90, 0.895, 0.90], name: 'dim=64', type: 'bar', marker: { color: '#f59e0b' } },
                { x: ['[64,32]', '[128,64]', '[128,64,32]', '[256,128,64]'], y: [0.905, 0.895, 0.89, 0.895], name: 'dim=128', type: 'bar', marker: { color: '#10b981' } }
            ], {
                barmode: 'group',
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                xaxis: { title: 'Hidden Layers', gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)', range: [0.88, 0.93] },
                legend: { x: 1, xanchor: 'right', y: 1 }, margin: { t: 20, b: 50 }
            }, { responsive: true });
            
            // 8. Response Surface 3D
            const xSurf = [], ySurf = [], zSurf = [];
            for (let k = 10; k <= 100; k += 10) {
                for (let r = 0.01; r <= 0.1; r += 0.01) {
                    xSurf.push(k);
                    ySurf.push(r);
                    zSurf.push(0.85 + 0.05 * Math.exp(-Math.pow(k-50,2)/1000) + 0.08 * Math.exp(-Math.pow(r-0.02,2)/0.001) + Math.random() * 0.01);
                }
            }
            Plotly.newPlot('response-surface-chart', [{
                x: xSurf, y: ySurf, z: zSurf,
                type: 'mesh3d', opacity: 0.8, colorscale: 'RdYlGn', reversescale: true
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                scene: {
                    xaxis: { title: 'n_factors', gridcolor: 'rgba(255,255,255,0.1)' },
                    yaxis: { title: 'regularization', gridcolor: 'rgba(255,255,255,0.1)' },
                    zaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                    camera: { eye: { x: 1.5, y: 1.5, z: 1 } }
                },
                margin: { t: 20, b: 20 }
            }, { responsive: true });
            
            // 9. Pareto Chart
            const paretoData = [
                { name: 'MF-SVD (k=50)', rmse: 0.8956, time: 1.5, coverage: 66.8 },
                { name: 'MF-SVD (k=100)', rmse: 0.89, time: 3.2, coverage: 72.1 },
                { name: 'NCF (deep)', rmse: 0.9012, time: 8.5, coverage: 52.3 },
                { name: 'User-CF', rmse: 0.9456, time: 0.07, coverage: 4.0 },
                { name: 'Graph-PR', rmse: 0.9547, time: 1.2, coverage: 47.0 },
                { name: 'Hybrid', rmse: 0.9145, time: 3.2, coverage: 48.7 },
                { name: 'Pop', rmse: 0.9808, time: 0.05, coverage: 5.0 }
            ];
            Plotly.newPlot('pareto-chart', [{
                x: paretoData.map(d => d.time), y: paretoData.map(d => d.rmse),
                mode: 'markers+text', type: 'scatter',
                text: paretoData.map(d => d.name), textposition: 'top center',
                marker: { size: paretoData.map(d => d.coverage / 3), color: paretoData.map(d => d.rmse),
                    colorscale: 'RdYlGn', reversescale: true, showscale: true, colorbar: { title: 'RMSE' } },
                textfont: { size: 9, color: '#94a3b8' }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                xaxis: { title: 'Training Time (seconds)', type: 'log', gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'RMSE (lower is better)', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 40, b: 60 }
            }, { responsive: true });
            
            // 10. ANOVA Chart
            Plotly.newPlot('anova-chart', [{
                x: ['n_factors', 'regularization', 'method', 'k_neighbors', 'similarity', 'embedding_dim', 'hidden_layers'],
                y: [42.3, 28.7, 15.2, 35.8, 12.4, 38.5, 22.1],
                type: 'bar',
                marker: { color: ['#3b82f6', '#3b82f6', '#3b82f6', '#10b981', '#10b981', '#ef4444', '#ef4444'] }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { title: 'Variance Explained (%)', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 80 }
            }, { responsive: true });
            
            // 11. CI Comparison
            Plotly.newPlot('ci-comparison-chart', [{
                x: ['MF-SVD', 'NCF', 'User-CF', 'Graph-PR', 'Hybrid'],
                y: [0.8956, 0.9012, 0.9456, 0.9547, 0.9145],
                error_y: { type: 'data', array: [0.012, 0.021, 0.022, 0.014, 0.013], visible: true },
                type: 'scatter', mode: 'markers', name: 'Tuned',
                marker: { size: 12, color: '#10b981' }
            }, {
                x: ['MF-SVD', 'NCF', 'User-CF', 'Graph-PR', 'Hybrid'],
                y: [0.95, 0.96, 0.98, 0.97, 0.96],
                error_y: { type: 'data', array: [0.02, 0.03, 0.03, 0.02, 0.025], visible: true },
                type: 'scatter', mode: 'markers', name: 'Default',
                marker: { size: 12, color: '#ef4444' }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                yaxis: { title: 'RMSE (95% CI)', gridcolor: 'rgba(255,255,255,0.1)' },
                legend: { x: 1, xanchor: 'right', y: 1 }, margin: { t: 20, b: 60 }
            }, { responsive: true });
            
            // 12. HP Importance
            Plotly.newPlot('hp-importance-chart', [{
                y: ['method', 'similarity', 'min_df', 'dropout', 'cf_weight', 'damping', 'hidden_layers', 'k_neighbors', 'regularization', 'n_factors'],
                x: [0.08, 0.12, 0.05, 0.15, 0.18, 0.22, 0.28, 0.35, 0.42, 0.52],
                type: 'bar', orientation: 'h',
                marker: { color: '#3b82f6' }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                xaxis: { title: 'Feature Importance', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 50, l: 100 }
            }, { responsive: true });
            
            // Initialize HP table and playground
            switchHPTable('movielens');
            initPlayground();
            initPlaygroundChart();
        }
        
        // ============= HP TABLE SWITCHING =============
        function switchHPTable(dataset) {
            ['movielens', 'amazon', 'bookcrossing'].forEach(d => {
                const btn = document.getElementById('hp-btn-' + d);
                if (btn) btn.classList.toggle('active', d === dataset);
            });
            
            const configs = {
                'movielens': [
                    { algo: 'MF-SVD', config: 'k=50, Œª=0.02', rmse: 0.8956, ndcg: 0.0286, improvement: '12.3%' },
                    { algo: 'NCF', config: 'dim=64, [128,64,32], drop=0.2', rmse: 0.9012, ndcg: 0.0312, improvement: '9.8%' },
                    { algo: 'User-CF', config: 'k=20, cosine', rmse: 0.9456, ndcg: 0.0178, improvement: '5.2%' },
                    { algo: 'Item-CF', config: 'k=30, cosine', rmse: 0.9678, ndcg: 0.0165, improvement: '3.1%' },
                    { algo: 'Graph-PR', config: 'Œ±=0.85, 20 walks', rmse: 0.9547, ndcg: 0.0271, improvement: '4.5%' },
                    { algo: 'Hybrid', config: 'w_cf=0.6, weighted', rmse: 0.9145, ndcg: 0.0267, improvement: '8.2%' }
                ],
                'amazon': [
                    { algo: 'NCF', config: 'dim=64, [128,64,32], drop=0.3', rmse: 1.0012, ndcg: 0.0312, improvement: '10.5%' },
                    { algo: 'MF-SVD', config: 'k=100, Œª=0.01', rmse: 1.0234, ndcg: 0.0234, improvement: '8.2%' },
                    { algo: 'Graph-PR', config: 'Œ±=0.9, 30 walks', rmse: 1.0123, ndcg: 0.0287, improvement: '9.1%' },
                    { algo: 'Hybrid', config: 'w_cf=0.5, cascade', rmse: 1.0145, ndcg: 0.0267, improvement: '8.8%' },
                    { algo: 'Content', config: '500 feat, (1,2)-gram', rmse: 1.0345, ndcg: 0.0265, improvement: '6.2%' },
                    { algo: 'User-CF', config: 'k=30, cosine', rmse: 1.1234, ndcg: 0.0087, improvement: '2.1%' }
                ],
                'bookcrossing': [
                    { algo: 'NCF', config: 'dim=128, [256,128,64], drop=0.3', rmse: 1.0876, ndcg: 0.0289, improvement: '11.2%' },
                    { algo: 'Graph-PR', config: 'Œ±=0.9, 50 walks', rmse: 1.0987, ndcg: 0.0265, improvement: '10.1%' },
                    { algo: 'Hybrid', config: 'w_cf=0.4, switching', rmse: 1.1012, ndcg: 0.0245, improvement: '9.8%' },
                    { algo: 'Content', config: '1000 feat, (1,3)-gram', rmse: 1.1234, ndcg: 0.0212, improvement: '7.5%' },
                    { algo: 'MF-SVD', config: 'k=100, Œª=0.01', rmse: 1.1456, ndcg: 0.0178, improvement: '5.8%' },
                    { algo: 'User-CF', config: 'k=50, cosine', rmse: 1.2145, ndcg: 0.0076, improvement: '1.2%' }
                ]
            };
            
            const data = configs[dataset];
            let html = '<div class="table-container"><table><thead><tr><th>Rank</th><th>Algorithm</th><th>Optimal Configuration</th><th>RMSE</th><th>NDCG@10</th><th>Improvement</th></tr></thead><tbody>';
            data.forEach((row, i) => {
                html += '<tr><td><strong>#' + (i+1) + '</strong></td><td><strong>' + row.algo + '</strong></td><td><code>' + row.config + '</code></td><td class="' + (i===0 ? 'best' : '') + '">' + row.rmse.toFixed(4) + '</td><td>' + row.ndcg.toFixed(4) + '</td><td style="color: var(--success);">‚Üë' + row.improvement + '</td></tr>';
            });
            html += '</tbody></table></div>';
            document.getElementById('hp-table-container').innerHTML = html;
        }
        
        // ============= PLAYGROUND FUNCTIONS =============
        let playgroundState = { algo: 'mf', dataset: 'movielens', params: {} };
        
        function initPlayground() {
            updatePlaygroundParams();
        }
        
        function updatePlayground() {
            playgroundState.algo = document.getElementById('playground-algo').value;
            playgroundState.dataset = document.getElementById('playground-dataset').value;
            updatePlaygroundParams();
        }
        
        function updatePlaygroundParams() {
            const algo = playgroundState.algo;
            const paramsHTML = {
                'mf': `
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>n_factors (k)</span><span id="val-factors">50</span></label>
                        <input type="range" min="10" max="200" value="50" id="param-factors" oninput="document.getElementById('val-factors').textContent=this.value" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>regularization (Œª)</span><span id="val-reg">0.02</span></label>
                        <input type="range" min="1" max="20" value="2" id="param-reg" oninput="document.getElementById('val-reg').textContent=(this.value/100).toFixed(2)" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Method</label>
                        <select id="param-method" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="svd">SVD</option>
                            <option value="als">ALS</option>
                            <option value="funk">Funk SVD</option>
                        </select>
                    </div>`,
                'cf': `
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>k_neighbors</span><span id="val-k">20</span></label>
                        <input type="range" min="5" max="100" value="20" id="param-k" oninput="document.getElementById('val-k').textContent=this.value" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Similarity</label>
                        <select id="param-sim" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="cosine">Cosine</option>
                            <option value="pearson">Pearson</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Method</label>
                        <select id="param-cfmethod" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="user">User-Based</option>
                            <option value="item">Item-Based</option>
                        </select>
                    </div>`,
                'ncf': `
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>embedding_dim</span><span id="val-dim">64</span></label>
                        <input type="range" min="16" max="256" step="16" value="64" id="param-dim" oninput="document.getElementById('val-dim').textContent=this.value" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Hidden Layers</label>
                        <select id="param-layers" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="[64,32]">[64, 32]</option>
                            <option value="[128,64]">[128, 64]</option>
                            <option value="[128,64,32]" selected>[128, 64, 32]</option>
                            <option value="[256,128,64]">[256, 128, 64]</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>dropout</span><span id="val-drop">0.2</span></label>
                        <input type="range" min="0" max="5" value="2" id="param-drop" oninput="document.getElementById('val-drop').textContent=(this.value/10).toFixed(1)" style="width: 100%;">
                    </div>`,
                'graph': `
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>damping (Œ±)</span><span id="val-alpha">0.85</span></label>
                        <input type="range" min="50" max="95" value="85" id="param-alpha" oninput="document.getElementById('val-alpha').textContent=(this.value/100).toFixed(2)" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>n_walks</span><span id="val-walks">20</span></label>
                        <input type="range" min="5" max="100" value="20" id="param-walks" oninput="document.getElementById('val-walks').textContent=this.value" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Method</label>
                        <select id="param-graphmethod" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="pagerank">PageRank</option>
                            <option value="randomwalk">Random Walk</option>
                        </select>
                    </div>`,
                'hybrid': `
                    <div style="margin-bottom: 16px;">
                        <label style="display: flex; justify-content: space-between;"><span>CF Weight</span><span id="val-cfw">0.6</span></label>
                        <input type="range" min="0" max="100" value="60" id="param-cfw" oninput="document.getElementById('val-cfw').textContent=(this.value/100).toFixed(2)" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 8px;">Strategy</label>
                        <select id="param-strategy" style="width: 100%; padding: 8px; border-radius: 6px; background: var(--darker); border: 1px solid var(--border); color: var(--text);">
                            <option value="weighted">Weighted</option>
                            <option value="switching">Switching</option>
                            <option value="cascade">Cascade</option>
                        </select>
                    </div>`
            };
            document.getElementById('playground-params').innerHTML = paramsHTML[algo] || '';
        }
        
        function runSimulation() {
            const algo = playgroundState.algo;
            const dataset = playgroundState.dataset;
            
            // Simulated prediction model (simplified)
            const baselines = {
                'movielens': { mf: 0.95, cf: 0.98, ncf: 0.96, graph: 0.97, hybrid: 0.96 },
                'amazon': { mf: 1.08, cf: 1.15, ncf: 1.05, graph: 1.06, hybrid: 1.05 },
                'bookcrossing': { mf: 1.20, cf: 1.25, ncf: 1.15, graph: 1.12, hybrid: 1.14 }
            };
            
            let rmse = baselines[dataset][algo];
            let ndcg = 0.02;
            let time = 1.0;
            let coverage = 50;
            
            // Adjust based on parameters
            if (algo === 'mf') {
                const k = parseInt(document.getElementById('param-factors')?.value || 50);
                const reg = parseFloat(document.getElementById('val-reg')?.textContent || 0.02);
                rmse -= 0.05 * (1 - Math.exp(-k/30));
                rmse += 0.1 * Math.abs(reg - 0.02);
                time = 0.5 + k * 0.02;
                coverage = 40 + k * 0.3;
                ndcg = 0.03 - 0.01 * (rmse - 0.85);
            } else if (algo === 'cf') {
                const k = parseInt(document.getElementById('param-k')?.value || 20);
                const sim = document.getElementById('param-sim')?.value || 'cosine';
                rmse -= 0.03 * (1 - Math.exp(-k/20));
                if (sim === 'pearson' && dataset !== 'movielens') rmse += 0.02;
                time = 0.05 + k * 0.001;
                coverage = 2 + k * 0.05;
            } else if (algo === 'ncf') {
                const dim = parseInt(document.getElementById('param-dim')?.value || 64);
                const drop = parseFloat(document.getElementById('val-drop')?.textContent || 0.2);
                rmse -= 0.06 * (1 - Math.exp(-dim/50));
                rmse += 0.02 * Math.abs(drop - 0.2);
                time = 5 + dim * 0.05;
                coverage = 45 + dim * 0.1;
                ndcg = 0.035 - 0.015 * (rmse - 0.85);
            }
            
            // Update UI
            document.getElementById('pred-rmse').textContent = rmse.toFixed(4);
            document.getElementById('pred-ndcg').textContent = ndcg.toFixed(4);
            document.getElementById('pred-time').textContent = time.toFixed(1) + 's';
            document.getElementById('pred-coverage').textContent = coverage.toFixed(1) + '%';
            
            const improvement = ((baselines[dataset][algo] - rmse) / baselines[dataset][algo] * 100);
            document.getElementById('rmse-delta').textContent = (improvement >= 0 ? '-' : '+') + Math.abs(improvement).toFixed(1) + '% vs baseline';
            document.getElementById('rmse-delta').style.color = improvement >= 0 ? 'var(--success)' : 'var(--error)';
            
            // Update config summary
            updateConfigSummary();
            
            // Update recommendation
            updateRecommendation(rmse, improvement, dataset, algo);
            
            // Update comparison chart
            updatePlaygroundChart(rmse, dataset, algo);
        }
        
        function updateConfigSummary() {
            const algo = playgroundState.algo;
            const algoNames = { mf: 'MF-SVD', cf: 'Collaborative Filtering', ncf: 'Neural CF', graph: 'Graph-Based', hybrid: 'Hybrid' };
            let summary = 'algorithm: ' + algoNames[algo] + '<br>';
            
            if (algo === 'mf') {
                summary += 'n_factors: ' + (document.getElementById('param-factors')?.value || 50) + '<br>';
                summary += 'regularization: ' + (document.getElementById('val-reg')?.textContent || '0.02') + '<br>';
                summary += 'method: ' + (document.getElementById('param-method')?.value || 'svd');
            } else if (algo === 'cf') {
                summary += 'k_neighbors: ' + (document.getElementById('param-k')?.value || 20) + '<br>';
                summary += 'similarity: ' + (document.getElementById('param-sim')?.value || 'cosine') + '<br>';
                summary += 'method: ' + (document.getElementById('param-cfmethod')?.value || 'user');
            }
            document.getElementById('config-summary').innerHTML = summary;
        }
        
        function updateRecommendation(rmse, improvement, dataset, algo) {
            let rec = '';
            if (improvement > 10) {
                rec = 'This configuration is <strong>excellent</strong>! Close to optimal for ' + dataset + '.';
            } else if (improvement > 5) {
                rec = 'This configuration is <strong>good</strong>. Consider fine-tuning for better results.';
            } else if (improvement > 0) {
                rec = 'This configuration is <strong>okay</strong>. Try adjusting key parameters.';
            } else {
                rec = '<strong>Warning:</strong> This config underperforms baseline. Check your settings.';
            }
            document.getElementById('playground-recommendation').innerHTML = rec;
        }
        
        function findOptimal() {
            const algo = playgroundState.algo;
            if (algo === 'mf') {
                document.getElementById('param-factors').value = 50;
                document.getElementById('val-factors').textContent = '50';
                document.getElementById('param-reg').value = 2;
                document.getElementById('val-reg').textContent = '0.02';
            } else if (algo === 'cf') {
                document.getElementById('param-k').value = 20;
                document.getElementById('val-k').textContent = '20';
                document.getElementById('param-sim').value = 'cosine';
            } else if (algo === 'ncf') {
                document.getElementById('param-dim').value = 64;
                document.getElementById('val-dim').textContent = '64';
                document.getElementById('param-drop').value = 2;
                document.getElementById('val-drop').textContent = '0.2';
            }
            runSimulation();
        }
        
        function initPlaygroundChart() {
            Plotly.newPlot('playground-comparison-chart', [{
                x: ['Your Config', 'Optimal', 'Default', 'Baseline'],
                y: [0.9, 0.8956, 0.95, 1.02],
                type: 'bar',
                marker: { color: ['#3b82f6', '#10b981', '#f59e0b', '#6b7280'] }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 40 }
            }, { responsive: true });
        }
        
        function updatePlaygroundChart(userRmse, dataset, algo) {
            const optimals = { movielens: 0.8956, amazon: 1.0012, bookcrossing: 1.0876 };
            const defaults = { movielens: 0.95, amazon: 1.08, bookcrossing: 1.20 };
            const baselines = { movielens: 1.02, amazon: 1.15, bookcrossing: 1.28 };
            
            Plotly.react('playground-comparison-chart', [{
                x: ['Your Config', 'Optimal', 'Default', 'Baseline'],
                y: [userRmse, optimals[dataset], defaults[dataset], baselines[dataset]],
                type: 'bar',
                marker: { color: ['#3b82f6', '#10b981', '#f59e0b', '#6b7280'] }
            }], {
                paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: { color: '#94a3b8' },
                yaxis: { title: 'RMSE', gridcolor: 'rgba(255,255,255,0.1)' },
                margin: { t: 20, b: 40 }
            });
        }
        
        function showAlgoHP(algo) {
            // Could open a modal with detailed HP info - for now just alert
            const details = {
                'cf': 'Collaborative Filtering: k_neighbors (5-100), similarity (cosine/pearson), method (user/item)',
                'mf': 'Matrix Factorization: n_factors (10-200), regularization (0.001-0.2), method (svd/als/funk)',
                'cb': 'Content-Based: max_features (100-1000), ngram_range, min_df (1-10)',
                'graph': 'Graph-Based: damping (0.5-0.95), n_walks (5-100), method (pagerank/random_walk)',
                'ncf': 'Neural CF: embedding_dim (16-256), hidden_layers, dropout (0-0.5)',
                'hybrid': 'Hybrid: cf_weight (0-1), method (weighted/switching/cascade)'
            };
            alert(details[algo] || 'Details not available');
        }
        
        function filterDataset(dataset) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            // Update table would go here
        }
        
        // Initialize
        
        // ============= DYNAMIC TABLE FUNCTIONS =============
        const datasetDisplayNames = {
            'movielens': 'MovieLens-100K',
            'amazon': 'Amazon-Style', 
            'bookcrossing': 'BookCrossing-Style'
        };
        
        function switchMainTable(dataset) {
            // Update buttons
            ['movielens', 'amazon', 'bookcrossing'].forEach(d => {
                const btn = document.getElementById('btn-' + d);
                if (btn) btn.classList.toggle('active', d === dataset);
            });
            
            // Update subtitle
            const subtitle = document.getElementById('main-table-subtitle');
            if (subtitle) {
                subtitle.textContent = 'Results on ' + datasetDisplayNames[dataset] + ' (mean ¬± std over 25 runs)';
            }
            
            // Get data
            const dsKey = datasetDisplayNames[dataset];
            const ds = resultsData.datasets[dsKey];
            const algos = resultsData.algorithms;
            if (!ds) return;
            
            const bestRMSE = Math.min(...ds.rmse);
            const bestNDCG = Math.max(...ds.ndcg10);
            
            let html = '<table><thead><tr><th>Algorithm</th><th>RMSE ‚Üì</th><th>MAE ‚Üì</th><th>NDCG@10 ‚Üë</th><th>P@10 ‚Üë</th><th>R@10 ‚Üë</th><th>Coverage</th><th>Time</th></tr></thead><tbody>';
            
            algos.forEach((algo, i) => {
                html += '<tr><td><strong>' + algo + '</strong></td>';
                html += '<td class="' + (ds.rmse[i] === bestRMSE ? 'best' : '') + '">' + ds.rmse[i].toFixed(4) + ' ¬± ' + ds.rmse_std[i].toFixed(3) + '</td>';
                html += '<td>' + ds.mae[i].toFixed(4) + '</td>';
                html += '<td class="' + (ds.ndcg10[i] === bestNDCG ? 'best' : '') + '">' + ds.ndcg10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.precision10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.recall10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.coverage[i].toFixed(1) + '%</td>';
                html += '<td>' + ds.train_time[i].toFixed(2) + 's</td></tr>';
            });
            html += '</tbody></table>';
            
            document.getElementById('main-results-table').innerHTML = html;
        }
        
        function switchDetailedTable(dataset) {
            // Update buttons
            ['movielens', 'amazon', 'bookcrossing'].forEach(d => {
                const btn = document.getElementById('detail-btn-' + d);
                if (btn) btn.classList.toggle('active', d === dataset);
            });
            
            const dsKey = datasetDisplayNames[dataset];
            const ds = resultsData.datasets[dsKey];
            const algos = resultsData.algorithms;
            if (!ds) return;
            
            const dsInfo = {
                'MovieLens-100K': { users: '943', items: '1,682', ratings: '100K', sparsity: '93.7%' },
                'Amazon-Style': { users: '2,000', items: '1,000', ratings: '28K', sparsity: '98.6%' },
                'BookCrossing-Style': { users: '3,000', items: '2,000', ratings: '40K', sparsity: '99.3%' }
            }[dsKey];
            
            const bestRMSE = Math.min(...ds.rmse);
            
            let html = '<div class="context-box info" style="margin-bottom:20px"><h3>üìä ' + dsKey + '</h3>';
            html += '<p style="margin-top:8px;color:var(--text-muted)"><strong>' + dsInfo.users + '</strong> users ‚Ä¢ <strong>' + dsInfo.items + '</strong> items ‚Ä¢ <strong>' + dsInfo.ratings + '</strong> ratings ‚Ä¢ <strong>' + dsInfo.sparsity + '</strong> sparsity</p></div>';
            html += '<div class="table-container"><table><thead><tr><th>Algorithm</th><th>RMSE ‚Üì</th><th>MAE ‚Üì</th><th>NDCG@5</th><th>NDCG@10</th><th>P@10</th><th>R@10</th><th>Coverage</th><th>Time</th></tr></thead><tbody>';
            
            algos.forEach((algo, i) => {
                html += '<tr><td><strong>' + algo + '</strong></td>';
                html += '<td class="' + (ds.rmse[i] === bestRMSE ? 'best' : '') + '">' + ds.rmse[i].toFixed(4) + ' ¬± ' + ds.rmse_std[i].toFixed(3) + '</td>';
                html += '<td>' + ds.mae[i].toFixed(4) + '</td>';
                html += '<td>' + ds.ndcg5[i].toFixed(4) + '</td>';
                html += '<td>' + ds.ndcg10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.precision10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.recall10[i].toFixed(4) + '</td>';
                html += '<td>' + ds.coverage[i].toFixed(1) + '%</td>';
                html += '<td>' + ds.train_time[i].toFixed(2) + 's</td></tr>';
            });
            html += '</tbody></table></div>';
            
            document.getElementById('detailed-results-container').innerHTML = html;
        }
        
document.addEventListener('DOMContentLoaded', () => {
            initOverviewCharts();
            // Initialize tables
            if (document.getElementById('main-results-table')) switchMainTable('movielens');
            if (document.getElementById('detailed-results-container')) switchDetailedTable('movielens');
            // Initialize narration system
            initNarration();
        });
    </script>
    
    <!-- ==================== NARRATION PANEL ==================== -->
    <div id="narration-panel">
        <div class="narration-header">
            <span>üéß Audio Guide</span>
            <button class="narration-minimize" onclick="toggleNarrationPanel()" title="Minimize">‚àí</button>
        </div>
        
        <div class="narration-body">
            <div class="narration-status-row">
                <span id="narration-status" class="narration-status ready">Ready</span>
            </div>
            
            <div class="narration-buttons">
                <button id="narration-play-btn" onclick="narrationToggle()" title="Play/Pause">‚ñ∂Ô∏è</button>
                <button onclick="narrationStop()" title="Stop">‚èπÔ∏è</button>
                <button id="narration-mute-btn" onclick="toggleNarrationMute()" title="Mute/Unmute">üîä</button>
            </div>
            
            <div class="narration-setting">
                <label>üéôÔ∏è Voice:</label>
                <select id="voice-selector" onchange="setNarrationVoice(this.value)">
                    <option value="">Loading voices...</option>
                </select>
            </div>
            
            <div class="narration-setting">
                <label>‚ö° Speed: <span id="speed-value" style="color: var(--primary); font-weight: 600;">1.0x</span></label>
                <input type="range" id="speed-slider" min="0.5" max="2" step="0.1" value="1" 
                       oninput="updateNarrationSpeed(this.value)">
            </div>
            
            <div class="narration-setting">
                <label>
                    <input type="checkbox" id="captions-toggle" checked 
                           onchange="toggleNarrationCaptions()">
                    üìù Show Captions
                </label>
            </div>
            
            <div class="narration-setting">
                <label>
                    <input type="checkbox" id="auto-narrate-toggle">
                    üîÑ Auto-narrate on page change
                </label>
            </div>
            
            <div class="narration-quick-actions">
                <button onclick="narrateCurrentPage()">
                    üìñ Explain This Page
                </button>
                <button class="secondary" onclick="showSceneSelector()">
                    üé¨ Page Topics
                </button>
                <button class="secondary" onclick="showAlgorithmSelector()" style="margin-top: 8px;">
                    üß† Algorithm Stories
                </button>
            </div>
            
            <div class="scene-nav" id="scene-nav" style="display: none;">
                <!-- Scene buttons will be populated dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Caption Overlay -->
    <div id="caption-overlay">
        <div class="caption-container">
            <div class="caption-header">
                <span class="caption-title">Narration</span>
                <button class="caption-close" onclick="hideCaptions()">√ó</button>
            </div>
            <div class="caption-text" id="caption-text"></div>
        </div>
    </div>
    
    <!-- ==================== VISUAL COMPANION PANEL ==================== -->
    <div id="visual-companion" class="visual-companion">
        <div class="vc-header" id="vc-header">
            <span class="vc-title">üìä Visual Guide <span class="drag-hint">(drag to move)</span></span>
            <div class="vc-controls">
                <button class="vc-btn" onclick="toggleVisualCompanion()" title="Minimize">‚àí</button>
                <button class="vc-btn" onclick="closeVisualCompanion()" title="Close">√ó</button>
            </div>
        </div>
        <div class="vc-body">
            <div class="vc-section vc-topic">
                <div class="vc-section-title">üéØ Current Topic</div>
                <div id="vc-topic-name" class="vc-topic-name">Welcome</div>
            </div>
            
            <div class="vc-section vc-keyterms">
                <div class="vc-section-title">üìö Key Terms</div>
                <div id="vc-terms" class="vc-terms-list"></div>
            </div>
            
            <div class="vc-section vc-math">
                <div class="vc-section-title">üî¢ Formulas</div>
                <div id="vc-formulas" class="vc-formulas-list"></div>
            </div>
            
            <div class="vc-section vc-flow">
                <div class="vc-section-title">üîÑ Flow</div>
                <div id="vc-flowchart" class="vc-flowchart"></div>
            </div>
            
            <div class="vc-section vc-examples">
                <div class="vc-section-title">üí° Examples</div>
                <div id="vc-examples" class="vc-examples-list"></div>
            </div>
            
            <div class="vc-section vc-stats">
                <div class="vc-section-title">üìà Key Stats</div>
                <div id="vc-stats" class="vc-stats-grid"></div>
            </div>
        </div>
        <div class="vc-progress">
            <div id="vc-progress-bar" class="vc-progress-bar"></div>
        </div>
    </div>
    
    <style>
    /* ==================== VISUAL COMPANION STYLES ==================== */
    .visual-companion {
        position: fixed;
        top: 80px;
        right: 20px;
        width: 380px;
        max-height: calc(100vh - 100px);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.98));
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(37, 99, 235, 0.1);
        z-index: 1001;
        display: none;
        flex-direction: column;
        overflow: hidden;
        backdrop-filter: blur(20px);
        animation: vcSlideIn 0.4s ease-out;
        resize: both;
        min-width: 320px;
        min-height: 300px;
    }
    
    .visual-companion.dragging {
        opacity: 0.9;
        cursor: grabbing;
        user-select: none;
    }
    
    .visual-companion.active {
        display: flex;
    }
    
    .visual-companion.minimized {
        max-height: 50px;
    }
    
    .visual-companion.minimized .vc-body,
    .visual-companion.minimized .vc-progress {
        display: none;
    }
    
    @keyframes vcSlideIn {
        from { opacity: 0; transform: translateX(50px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    .vc-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 18px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-bottom: 1px solid var(--border);
        cursor: grab;
        user-select: none;
    }
    
    .vc-header:active {
        cursor: grabbing;
    }
    
    .vc-header .drag-hint {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-left: 8px;
    }
    
    .vc-title {
        font-weight: 600;
        font-size: 1rem;
        color: white;
    }
    
    .vc-controls {
        display: flex;
        gap: 8px;
    }
    
    .vc-btn {
        width: 26px;
        height: 26px;
        border: none;
        background: rgba(255,255,255,0.2);
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }
    
    .vc-btn:hover {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }
    
    .vc-body {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .vc-section {
        background: rgba(30, 41, 59, 0.6);
        border-radius: 12px;
        padding: 14px;
        border: 1px solid rgba(71, 85, 105, 0.4);
        transition: all 0.3s;
    }
    
    .vc-section:hover {
        border-color: var(--primary);
        box-shadow: 0 0 20px rgba(37, 99, 235, 0.1);
    }
    
    .vc-section.hidden {
        display: none;
    }
    
    .vc-section-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 10px;
    }
    
    .vc-topic-name {
        font-size: 1.1rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.3;
    }
    
    .vc-terms-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .vc-term {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(124, 58, 237, 0.2));
        border: 1px solid rgba(37, 99, 235, 0.3);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }
    
    .vc-term:hover {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.4), rgba(124, 58, 237, 0.4));
        transform: translateY(-2px);
    }
    
    .vc-term .term-def {
        display: none;
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--dark);
        border: 1px solid var(--border);
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 0.75rem;
        width: 220px;
        z-index: 10;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        margin-bottom: 8px;
    }
    
    .vc-term:hover .term-def {
        display: block;
        animation: fadeIn 0.2s ease;
    }
    
    .vc-formulas-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .vc-formula {
        background: rgba(15, 23, 42, 0.8);
        padding: 12px 16px;
        border-radius: 8px;
        border-left: 3px solid var(--accent);
        font-family: 'Fira Code', monospace;
        font-size: 0.85rem;
        color: var(--text);
        overflow-x: auto;
    }
    
    .vc-formula-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-bottom: 6px;
        font-family: 'Inter', sans-serif;
    }
    
    .vc-flowchart {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 10px 0;
    }
    
    .vc-flow-node {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        min-width: 150px;
        animation: nodeAppear 0.3s ease-out backwards;
    }
    
    .vc-flow-node:nth-child(1) { animation-delay: 0.1s; }
    .vc-flow-node:nth-child(3) { animation-delay: 0.2s; }
    .vc-flow-node:nth-child(5) { animation-delay: 0.3s; }
    .vc-flow-node:nth-child(7) { animation-delay: 0.4s; }
    .vc-flow-node:nth-child(9) { animation-delay: 0.5s; }
    
    @keyframes nodeAppear {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .vc-flow-arrow {
        color: var(--text-muted);
        font-size: 1.2rem;
    }
    
    .vc-examples-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .vc-example {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 10px;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 8px;
    }
    
    .vc-example-icon {
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    
    .vc-example-text {
        font-size: 0.8rem;
        color: var(--text);
        line-height: 1.4;
    }
    
    .vc-stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .vc-stat {
        background: rgba(15, 23, 42, 0.8);
        padding: 12px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid rgba(71, 85, 105, 0.3);
    }
    
    .vc-stat-value {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary);
    }
    
    .vc-stat-label {
        font-size: 0.65rem;
        color: var(--text-muted);
        margin-top: 4px;
        text-transform: uppercase;
    }
    
    .vc-progress {
        height: 4px;
        background: rgba(30, 41, 59, 0.8);
    }
    
    .vc-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        width: 0%;
        transition: width 0.3s ease;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .visual-companion {
            width: calc(100% - 40px);
            right: 20px;
            left: 20px;
            max-height: 50vh;
        }
    }
    </style>
    
    <!-- ==================== TERMINOLOGY LEGEND PANEL ==================== -->
    <div id="terminology-legend" class="terminology-legend">
        <div class="legend-header" id="legend-header">
            <span class="legend-title">üìñ Research Terminology</span>
            <div class="legend-controls">
                <div class="opacity-control" title="Adjust opacity">
                    <span>üëÅ</span>
                    <input type="range" id="legend-opacity" min="0.3" max="1" step="0.1" value="0.95" 
                           onchange="setLegendOpacity(this.value)">
                </div>
                <button class="legend-btn" onclick="toggleLegendMinimize()" title="Minimize">‚àí</button>
                <button class="legend-btn" onclick="closeLegend()" title="Close">√ó</button>
            </div>
        </div>
        <div class="legend-body">
            <div class="legend-search">
                <input type="text" id="legend-search" placeholder="üîç Search terms..." oninput="filterLegendTerms(this.value)">
            </div>
            
            <!-- Experimental Design -->
            <div class="legend-category" data-category="experimental">
                <div class="legend-category-header" onclick="toggleLegendCategory('experimental')">
                    <span>üî¨ Experimental Design</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-experimental">
                    <div class="legend-term">
                        <span class="term-name">5-Fold Cross-Validation</span>
                        <span class="term-def">Data split into 5 parts; train on 4, test on 1, rotate 5 times. Ensures robust evaluation by testing on all data.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Random Seed</span>
                        <span class="term-def">Number that initializes random number generator. Same seed = reproducible results. We use 25 different seeds.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Train/Test Split</span>
                        <span class="term-def">Dividing data into training set (80%) for learning and test set (20%) for evaluation. Prevents overfitting.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Holdout Validation</span>
                        <span class="term-def">Reserving a portion of data for final testing, never seen during training or tuning.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Baseline</span>
                        <span class="term-def">Simple reference method (e.g., predict average rating) to compare against. All algorithms should beat the baseline.</span>
                    </div>
                </div>
            </div>
            
            <!-- Hyperparameters -->
            <div class="legend-category" data-category="hyperparams">
                <div class="legend-category-header" onclick="toggleLegendCategory('hyperparams')">
                    <span>üéõÔ∏è Hyperparameters</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-hyperparams">
                    <div class="legend-term">
                        <span class="term-name">Hyperparameter</span>
                        <span class="term-def">Settings configured BEFORE training (learning rate, factors). Unlike parameters which are learned FROM data.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Latent Factors (k)</span>
                        <span class="term-def">Hidden dimensions in matrix factorization. k=50 means each user/item represented by 50 numbers. More = complex.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Learning Rate (Œ±)</span>
                        <span class="term-def">Step size for gradient descent. Too high = unstable. Too low = slow. Sweet spot: 0.001-0.01.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Regularization (Œª)</span>
                        <span class="term-def">Penalty term preventing overfitting. Higher Œª = simpler model. Typical range: 0.001-0.1.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">K Neighbors</span>
                        <span class="term-def">Number of similar users/items to consider in collaborative filtering. Typical: 20-50.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Grid Search</span>
                        <span class="term-def">Exhaustively testing all combinations of hyperparameters to find optimal settings.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Epochs/Iterations</span>
                        <span class="term-def">Number of complete passes through training data. More epochs = better fit but risk overfitting.</span>
                    </div>
                </div>
            </div>
            
            <!-- Evaluation Metrics -->
            <div class="legend-category" data-category="metrics">
                <div class="legend-category-header" onclick="toggleLegendCategory('metrics')">
                    <span>üìä Evaluation Metrics</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-metrics">
                    <div class="legend-term">
                        <span class="term-name">RMSE</span>
                        <span class="term-def">Root Mean Square Error. ‚àö(avg squared errors). Lower = better. Penalizes large errors heavily. Best: 0.8956.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">MAE</span>
                        <span class="term-def">Mean Absolute Error. Average of |predicted - actual|. More intuitive than RMSE. Lower = better.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">NDCG@K</span>
                        <span class="term-def">Normalized Discounted Cumulative Gain at K. Measures ranking quality. 1.0 = perfect ranking. Rewards top positions.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Precision@K</span>
                        <span class="term-def">Of top K recommendations, how many were relevant? Precision@10 = 0.7 means 7 of 10 were good.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Recall@K</span>
                        <span class="term-def">Of all relevant items, how many appeared in top K? High recall = found most good items.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Coverage</span>
                        <span class="term-def">Percentage of items the system can recommend. Low coverage = always recommending same popular items.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">F1-Score</span>
                        <span class="term-def">Harmonic mean of precision and recall. Balances both metrics. F1 = 2√ó(P√óR)/(P+R).</span>
                    </div>
                </div>
            </div>
            
            <!-- Statistical Tests -->
            <div class="legend-category" data-category="statistics">
                <div class="legend-category-header" onclick="toggleLegendCategory('statistics')">
                    <span>üìà Statistical Analysis</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-statistics">
                    <div class="legend-term">
                        <span class="term-name">p-value</span>
                        <span class="term-def">Probability results occurred by chance. p < 0.05 = statistically significant. p < 0.001 = highly significant.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Friedman Test</span>
                        <span class="term-def">Non-parametric test comparing multiple algorithms across datasets. œá¬≤ = 78.45 proves algorithms differ.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Nemenyi Test</span>
                        <span class="term-def">Post-hoc test after Friedman. Determines WHICH pairs of algorithms differ significantly.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Cohen's d</span>
                        <span class="term-def">Effect size measure. d=0.2 small, d=0.5 medium, d=0.8 large. Shows practical significance.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Critical Difference (CD)</span>
                        <span class="term-def">Minimum rank difference for statistical significance. Algorithms within CD are not significantly different.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Confidence Interval</span>
                        <span class="term-def">Range where true value likely falls. 95% CI means 95% confident true value is in range.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Standard Deviation (œÉ)</span>
                        <span class="term-def">Measure of spread. Low œÉ = consistent results. Reported as ¬± after mean values.</span>
                    </div>
                </div>
            </div>
            
            <!-- Algorithm Concepts -->
            <div class="legend-category" data-category="algorithms">
                <div class="legend-category-header" onclick="toggleLegendCategory('algorithms')">
                    <span>üß† Algorithm Concepts</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-algorithms">
                    <div class="legend-term">
                        <span class="term-name">Collaborative Filtering</span>
                        <span class="term-def">Recommends based on similar users' preferences. "Users like you also liked..." Core of Netflix, Amazon.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Matrix Factorization</span>
                        <span class="term-def">Decomposes rating matrix into user and item latent factors. R ‚âà P √ó Q'. Won Netflix Prize.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Content-Based Filtering</span>
                        <span class="term-def">Recommends items similar to what user liked before, based on item features (genre, author, etc.).</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Neural Collaborative Filtering</span>
                        <span class="term-def">Deep learning approach using neural networks to learn complex user-item interactions.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Embedding</span>
                        <span class="term-def">Dense vector representation of users/items in continuous space. Similar items have similar embeddings.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Cold Start Problem</span>
                        <span class="term-def">Challenge of recommending for new users/items with no history. Content-based helps with item cold start.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Implicit Feedback</span>
                        <span class="term-def">User signals without explicit ratings: clicks, views, time spent. SVD++ leverages these signals.</span>
                    </div>
                </div>
            </div>
            
            <!-- Data Concepts -->
            <div class="legend-category" data-category="data">
                <div class="legend-category-header" onclick="toggleLegendCategory('data')">
                    <span>üíæ Data Concepts</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-data">
                    <div class="legend-term">
                        <span class="term-name">Sparsity</span>
                        <span class="term-def">Percentage of missing ratings. 93.7% sparse = only 6.3% of user-item pairs have ratings. Higher = harder.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">User-Item Matrix</span>
                        <span class="term-def">Grid where rows=users, columns=items, cells=ratings. Most cells empty (sparse).</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Rating Scale</span>
                        <span class="term-def">Range of possible ratings. MovieLens uses 1-5 stars. Some systems use 1-10 or thumbs up/down.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">MovieLens 100K</span>
                        <span class="term-def">Benchmark dataset: 100,000 ratings from 943 users on 1,682 movies. Gold standard for research.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Long Tail</span>
                        <span class="term-def">Many items with few ratings. Popular items dominate, but value in recommending niche items.</span>
                    </div>
                </div>
            </div>
            
            <!-- Model Training -->
            <div class="legend-category" data-category="training">
                <div class="legend-category-header" onclick="toggleLegendCategory('training')">
                    <span>‚öôÔ∏è Model Training</span>
                    <span class="category-toggle">‚ñº</span>
                </div>
                <div class="legend-category-content" id="cat-training">
                    <div class="legend-term">
                        <span class="term-name">Gradient Descent</span>
                        <span class="term-def">Optimization algorithm that iteratively adjusts parameters to minimize error. Like rolling downhill.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">SGD</span>
                        <span class="term-def">Stochastic Gradient Descent. Updates parameters after each sample, not entire batch. Faster but noisier.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Overfitting</span>
                        <span class="term-def">Model memorizes training data but fails on new data. Prevented by regularization and validation.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Underfitting</span>
                        <span class="term-def">Model too simple to capture patterns. Need more factors, layers, or training time.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Convergence</span>
                        <span class="term-def">When training error stops decreasing. Model has learned all it can from the data.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Loss Function</span>
                        <span class="term-def">Mathematical function measuring prediction error. Training minimizes this function.</span>
                    </div>
                    <div class="legend-term">
                        <span class="term-name">Bias Terms</span>
                        <span class="term-def">User bias (tendency to rate high/low) and item bias (generally liked/disliked). Added to predictions.</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="legend-footer">
            <span class="legend-count" id="legend-count">50 terms</span>
            <button class="legend-expand-all" onclick="expandAllCategories()">Expand All</button>
            <button class="legend-collapse-all" onclick="collapseAllCategories()">Collapse All</button>
        </div>
    </div>
    
    <!-- Legend Toggle Button (always visible) -->
    <button id="legend-toggle-btn" class="legend-toggle-btn" onclick="toggleLegend()" title="Research Terminology">
        üìñ
    </button>
    
    <style>
    /* ==================== TERMINOLOGY LEGEND STYLES ==================== */
    .terminology-legend {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 420px;
        max-height: calc(100vh - 120px);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.98));
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(16, 185, 129, 0.1);
        z-index: 1002;
        display: none;
        flex-direction: column;
        overflow: hidden;
        backdrop-filter: blur(20px);
        animation: legendSlideIn 0.4s ease-out;
        transition: opacity 0.3s ease;
    }
    
    .terminology-legend.active {
        display: flex;
    }
    
    .terminology-legend.minimized .legend-body,
    .terminology-legend.minimized .legend-footer {
        display: none;
    }
    
    .terminology-legend.minimized {
        max-height: 50px;
    }
    
    @keyframes legendSlideIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .legend-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: linear-gradient(90deg, var(--success), #059669);
        border-bottom: 1px solid var(--border);
        cursor: move;
    }
    
    .legend-title {
        font-weight: 600;
        font-size: 0.95rem;
        color: white;
    }
    
    .legend-controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .opacity-control {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255,255,255,0.15);
        padding: 4px 10px;
        border-radius: 12px;
    }
    
    .opacity-control span {
        font-size: 0.8rem;
    }
    
    .opacity-control input[type="range"] {
        width: 60px;
        height: 4px;
        -webkit-appearance: none;
        background: rgba(255,255,255,0.3);
        border-radius: 2px;
        cursor: pointer;
    }
    
    .opacity-control input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
    }
    
    .legend-btn {
        width: 24px;
        height: 24px;
        border: none;
        background: rgba(255,255,255,0.2);
        color: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }
    
    .legend-btn:hover {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }
    
    .legend-body {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
    }
    
    .legend-search {
        margin-bottom: 12px;
    }
    
    .legend-search input {
        width: 100%;
        padding: 10px 14px;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        font-size: 0.85rem;
        outline: none;
        transition: border-color 0.2s;
    }
    
    .legend-search input:focus {
        border-color: var(--success);
    }
    
    .legend-search input::placeholder {
        color: var(--text-muted);
    }
    
    .legend-category {
        margin-bottom: 8px;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(71, 85, 105, 0.3);
    }
    
    .legend-category.hidden {
        display: none;
    }
    
    .legend-category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 14px;
        background: rgba(30, 41, 59, 0.6);
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text);
        transition: background 0.2s;
    }
    
    .legend-category-header:hover {
        background: rgba(30, 41, 59, 0.8);
    }
    
    .category-toggle {
        font-size: 0.7rem;
        transition: transform 0.2s;
    }
    
    .legend-category.collapsed .category-toggle {
        transform: rotate(-90deg);
    }
    
    .legend-category.collapsed .legend-category-content {
        display: none;
    }
    
    .legend-category-content {
        padding: 8px;
        background: rgba(15, 23, 42, 0.4);
    }
    
    .legend-term {
        padding: 8px 10px;
        margin-bottom: 6px;
        background: rgba(30, 41, 59, 0.5);
        border-radius: 8px;
        border-left: 3px solid var(--success);
        transition: all 0.2s;
    }
    
    .legend-term:last-child {
        margin-bottom: 0;
    }
    
    .legend-term:hover {
        background: rgba(30, 41, 59, 0.8);
        border-left-color: var(--primary);
    }
    
    .legend-term.hidden {
        display: none;
    }
    
    .legend-term.highlight {
        background: rgba(16, 185, 129, 0.2);
        border-left-color: var(--warning);
    }
    
    .term-name {
        display: block;
        font-weight: 600;
        font-size: 0.8rem;
        color: var(--success);
        margin-bottom: 4px;
    }
    
    .term-def {
        display: block;
        font-size: 0.75rem;
        color: var(--text-muted);
        line-height: 1.4;
    }
    
    .legend-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        background: rgba(30, 41, 59, 0.6);
        border-top: 1px solid var(--border);
    }
    
    .legend-count {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    
    .legend-expand-all,
    .legend-collapse-all {
        padding: 5px 10px;
        background: rgba(255,255,255,0.1);
        border: none;
        border-radius: 6px;
        color: var(--text);
        font-size: 0.7rem;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .legend-expand-all:hover,
    .legend-collapse-all:hover {
        background: rgba(255,255,255,0.2);
    }
    
    /* Legend toggle button */
    .legend-toggle-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--success), #059669);
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        z-index: 1001;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .legend-toggle-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 30px rgba(16, 185, 129, 0.6);
    }
    
    .legend-toggle-btn.hidden {
        display: none;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .terminology-legend {
            width: calc(100% - 40px);
            left: 20px;
            right: 20px;
            max-height: 60vh;
        }
        
        .legend-toggle-btn {
            width: 45px;
            height: 45px;
            font-size: 1.3rem;
        }
    }
    </style>
    
    <script>
    // ==================== TERMINOLOGY LEGEND FUNCTIONS ====================
    
    function toggleLegend() {
        const legend = document.getElementById('terminology-legend');
        const toggleBtn = document.getElementById('legend-toggle-btn');
        
        if (legend.classList.contains('active')) {
            legend.classList.remove('active');
            toggleBtn.classList.remove('hidden');
        } else {
            legend.classList.add('active');
            toggleBtn.classList.add('hidden');
            updateLegendCount();
        }
    }
    
    function closeLegend() {
        const legend = document.getElementById('terminology-legend');
        const toggleBtn = document.getElementById('legend-toggle-btn');
        legend.classList.remove('active');
        toggleBtn.classList.remove('hidden');
    }
    
    function toggleLegendMinimize() {
        const legend = document.getElementById('terminology-legend');
        legend.classList.toggle('minimized');
    }
    
    function setLegendOpacity(value) {
        const legend = document.getElementById('terminology-legend');
        legend.style.opacity = value;
    }
    
    function toggleLegendCategory(categoryId) {
        const category = document.querySelector(`[data-category="${categoryId}"]`);
        if (category) {
            category.classList.toggle('collapsed');
        }
    }
    
    function expandAllCategories() {
        document.querySelectorAll('.legend-category').forEach(cat => {
            cat.classList.remove('collapsed');
        });
    }
    
    function collapseAllCategories() {
        document.querySelectorAll('.legend-category').forEach(cat => {
            cat.classList.add('collapsed');
        });
    }
    
    function filterLegendTerms(query) {
        const searchTerm = query.toLowerCase().trim();
        const terms = document.querySelectorAll('.legend-term');
        const categories = document.querySelectorAll('.legend-category');
        let visibleCount = 0;
        
        // Reset all
        terms.forEach(term => {
            term.classList.remove('hidden', 'highlight');
        });
        categories.forEach(cat => {
            cat.classList.remove('hidden', 'collapsed');
        });
        
        if (searchTerm === '') {
            visibleCount = terms.length;
        } else {
            terms.forEach(term => {
                const name = term.querySelector('.term-name').textContent.toLowerCase();
                const def = term.querySelector('.term-def').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || def.includes(searchTerm)) {
                    term.classList.add('highlight');
                    visibleCount++;
                } else {
                    term.classList.add('hidden');
                }
            });
            
            // Hide categories with no visible terms
            categories.forEach(cat => {
                const visibleTerms = cat.querySelectorAll('.legend-term:not(.hidden)');
                if (visibleTerms.length === 0) {
                    cat.classList.add('hidden');
                }
            });
        }
        
        updateLegendCount(visibleCount);
    }
    
    function updateLegendCount(count) {
        const countEl = document.getElementById('legend-count');
        if (countEl) {
            const total = document.querySelectorAll('.legend-term').length;
            if (count !== undefined && count !== total) {
                countEl.textContent = `${count} of ${total} terms`;
            } else {
                countEl.textContent = `${total} terms`;
            }
        }
    }
    
    // Make legend draggable
    (function() {
        let isDragging = false;
        let startX, startY, startLeft, startBottom;
        
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('legend-header');
            const legend = document.getElementById('terminology-legend');
            
            if (!header || !legend) return;
            
            header.addEventListener('mousedown', function(e) {
                if (e.target.closest('.legend-btn') || e.target.closest('.opacity-control')) return;
                
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                
                const rect = legend.getBoundingClientRect();
                startLeft = rect.left;
                startBottom = window.innerHeight - rect.bottom;
                
                legend.style.transition = 'none';
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                let newLeft = startLeft + deltaX;
                let newBottom = startBottom - deltaY;
                
                // Keep within bounds
                const maxLeft = window.innerWidth - legend.offsetWidth;
                const maxBottom = window.innerHeight - legend.offsetHeight;
                
                newLeft = Math.max(0, Math.min(newLeft, maxLeft));
                newBottom = Math.max(0, Math.min(newBottom, maxBottom));
                
                legend.style.left = newLeft + 'px';
                legend.style.bottom = newBottom + 'px';
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    legend.style.transition = '';
                }
            });
        });
    })();
    </script>
    
    <!-- ==================== NARRATION SYSTEM JAVASCRIPT ==================== -->
    <script src="speech.js"></script>
</body>
</html>